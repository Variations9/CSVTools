<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSV to Google Sheets Converter</title>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        function CSVToSheetsConverter() {
          const [csvData, setCsvData] = useState('');
          const [parsedData, setParsedData] = useState([]);
          const [headers, setHeaders] = useState([]);
          const [copySuccess, setCopySuccess] = useState(false);
          const [fileName, setFileName] = useState('');

          const parseCSV = (text) => {
            const lines = text.trim().split('\n');
            if (lines.length === 0) return;

            // Parse CSV manually to handle quoted fields with commas
            const parseCSVLine = (line) => {
              const result = [];
              let current = '';
              let inQuotes = false;
              
              for (let i = 0; i < line.length; i++) {
                const char = line[i];
                const nextChar = line[i + 1];
                
                if (char === '"') {
                  if (inQuotes && nextChar === '"') {
                    current += '"';
                    i++; // Skip next quote
                  } else {
                    inQuotes = !inQuotes;
                  }
                } else if (char === ',' && !inQuotes) {
                  result.push(current);
                  current = '';
                } else {
                  current += char;
                }
              }
              result.push(current);
              return result;
            };

            // Parse headers
            const headerRow = parseCSVLine(lines[0]);
            setHeaders(headerRow);

            // Parse data rows
            const dataRows = [];
            for (let i = 1; i < lines.length; i++) {
              if (lines[i].trim()) {
                const row = parseCSVLine(lines[i]);
                dataRows.push(row);
              }
            }
            
            setParsedData(dataRows);
          };

          const handleFileUpload = (event) => {
            const file = event.target.files[0];
            if (file) {
              setFileName(file.name);
              const reader = new FileReader();
              reader.onload = (e) => {
                const text = e.target.result;
                setCsvData(text);
                parseCSV(text);
              };
              reader.readAsText(file);
            }
          };

          const handleTextInput = (text) => {
            setCsvData(text);
            if (text.trim()) {
              parseCSV(text);
            } else {
              setParsedData([]);
              setHeaders([]);
            }
          };

          const generateTSV = () => {
            if (parsedData.length === 0) return '';
            
            // Header row
            let tsv = headers.join('\t') + '\n';
            
            // Data rows
            parsedData.forEach(row => {
              tsv += row.join('\t') + '\n';
            });
            
            return tsv;
          };

          const copyToClipboard = async () => {
            const tsv = generateTSV();
            try {
              await navigator.clipboard.writeText(tsv);
              setCopySuccess(true);
              setTimeout(() => setCopySuccess(false), 2000);
            } catch (err) {
              alert('Failed to copy. Please try the download option.');
            }
          };

          const downloadTSV = () => {
            const tsv = generateTSV();
            const blob = new Blob([tsv], { type: 'text/tab-separated-values' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = fileName.replace('.csv', '.tsv') || 'converted-data.tsv';
            a.click();
            URL.revokeObjectURL(url);
          };

          const clearData = () => {
            setCsvData('');
            setParsedData([]);
            setHeaders([]);
            setFileName('');
            setCopySuccess(false);
          };

          return (
            <div className="min-h-screen bg-gradient-to-br from-green-50 to-teal-100 p-6">
              <div className="max-w-7xl mx-auto">
                <div className="bg-white rounded-lg shadow-xl p-6 mb-6">
                  <div className="flex items-center gap-3 mb-4">
                    <svg className="w-8 h-8 text-teal-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                    <h1 className="text-3xl font-bold text-gray-800">CSV to Google Sheets Converter</h1>
                  </div>
                  <p className="text-gray-600 mb-6">
                    Upload or paste your CSV file to convert it to a format ready for Google Sheets.
                  </p>

                  <div className="grid lg:grid-cols-2 gap-6">
                    {/* Input Section */}
                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        Input: CSV Data
                      </label>
                      
                      {/* File Upload */}
                      <div className="mb-4">
                        <label className="flex items-center justify-center w-full p-6 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-teal-500 hover:bg-teal-50 transition-colors">
                          <div className="text-center">
                            <svg className="w-8 h-8 text-gray-400 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                            </svg>
                            <span className="text-sm text-gray-600">
                              {fileName || 'Click to upload CSV file or drag and drop'}
                            </span>
                          </div>
                          <input
                            type="file"
                            accept=".csv"
                            onChange={handleFileUpload}
                            className="hidden"
                          />
                        </label>
                      </div>

                      <div className="text-center text-gray-500 text-sm mb-4">- OR -</div>

                      {/* Text Input */}
                      <textarea
                        value={csvData}
                        onChange={(e) => handleTextInput(e.target.value)}
                        placeholder="Paste your CSV data here..."
                        className="w-full h-80 p-4 border-2 border-gray-300 rounded-lg focus:border-teal-500 focus:outline-none font-mono text-xs"
                      />
                      
                      {csvData && (
                        <button
                          onClick={clearData}
                          className="mt-4 w-full bg-gray-500 text-white py-2 px-4 rounded-lg font-semibold hover:bg-gray-600 transition-colors"
                        >
                          Clear All
                        </button>
                      )}
                    </div>

                    {/* Output Section */}
                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        Output: Preview & Export
                      </label>
                      <div className="border-2 border-gray-300 rounded-lg h-96 overflow-auto bg-gray-50 p-4">
                        {parsedData.length === 0 ? (
                          <div className="flex items-center justify-center h-full text-gray-400">
                            Upload or paste CSV data to see preview
                          </div>
                        ) : (
                          <div className="overflow-x-auto">
                            <table className="w-full text-xs border-collapse">
                              <thead>
                                <tr className="bg-teal-100">
                                  {headers.map((header, idx) => (
                                    <th key={idx} className="p-2 text-left font-semibold border border-teal-200 sticky top-0 bg-teal-100">
                                      {header}
                                    </th>
                                  ))}
                                </tr>
                              </thead>
                              <tbody>
                                {parsedData.map((row, rowIdx) => (
                                  <tr key={rowIdx} className="border-b border-gray-200 hover:bg-teal-50">
                                    {row.map((cell, cellIdx) => (
                                      <td key={cellIdx} className="p-2 border border-gray-200">
                                        {cell}
                                      </td>
                                    ))}
                                  </tr>
                                ))}
                              </tbody>
                            </table>
                          </div>
                        )}
                      </div>

                      <div className="mt-4 bg-gray-100 p-3 rounded-lg text-sm text-gray-700">
                        <strong>Stats:</strong> {parsedData.length} rows Ã— {headers.length} columns
                      </div>
                      
                      {parsedData.length > 0 && (
                        <div className="mt-4 flex gap-3">
                          <button
                            onClick={copyToClipboard}
                            className="flex-1 bg-green-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-green-700 transition-colors flex items-center justify-center gap-2"
                          >
                            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                            </svg>
                            {copySuccess ? 'Copied!' : 'Copy to Clipboard'}
                          </button>
                          <button
                            onClick={downloadTSV}
                            className="flex-1 bg-teal-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-teal-700 transition-colors flex items-center justify-center gap-2"
                          >
                            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                            </svg>
                            Download TSV
                          </button>
                        </div>
                      )}
                      
                      {parsedData.length > 0 && (
                        <div className="mt-4 p-4 bg-teal-50 rounded-lg border border-teal-200">
                          <p className="text-sm text-teal-800 font-semibold mb-1">ðŸ“‹ How to paste into Google Sheets:</p>
                          <ol className="text-sm text-teal-700 space-y-1 ml-4 list-decimal">
                            <li>Click "Copy to Clipboard" above</li>
                            <li>Open Google Sheets and select cell A1</li>
                            <li>Press Ctrl+V (or Cmd+V on Mac)</li>
                            <li>Your data will fill into columns automatically!</li>
                          </ol>
                        </div>
                      )}
                    </div>
                  </div>
                </div>

                {/* Instructions */}
                <div className="bg-white rounded-lg shadow-lg p-6">
                  <h2 className="text-xl font-bold text-gray-800 mb-3">ðŸ’¡ Tips</h2>
                  <ul className="space-y-2 text-gray-700">
                    <li className="flex items-start gap-2">
                      <span className="text-teal-600 font-bold">â€¢</span>
                      <span><strong>Preserves all your edits:</strong> Upload your edited CSV with summaries and custom data - everything is preserved</span>
                    </li>
                    <li className="flex items-start gap-2">
                      <span className="text-teal-600 font-bold">â€¢</span>
                      <span><strong>Handles complex data:</strong> Properly parses quoted fields, commas within cells, and special characters</span>
                    </li>
                    <li className="flex items-start gap-2">
                      <span className="text-teal-600 font-bold">â€¢</span>
                      <span><strong>Two input methods:</strong> Upload a .csv file or paste CSV text directly</span>
                    </li>
                    <li className="flex items-start gap-2">
                      <span className="text-teal-600 font-bold">â€¢</span>
                      <span><strong>Easy export:</strong> Copy to clipboard for instant paste, or download as TSV file</span>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          );
        }

        ReactDOM.render(<CSVToSheetsConverter />, document.getElementById('root'));
    </script>
</body>
</html>