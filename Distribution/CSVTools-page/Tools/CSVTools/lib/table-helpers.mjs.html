<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formatted Code - JavaScript</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', Courier, monospace;
            background: #ffffff;
            padding: 3rem;
            color: #000000;
            line-height: 1.6;
            font-size: 12pt;
            font-weight: bold;
            font-style: normal;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: #ffffff;
        }

        .code-container {
            background: #ffffff;
            padding: 0;
        }

        .code-line {
            white-space: pre-wrap;
            word-wrap: break-word;
            margin-bottom: 0.1rem;
        }

        .comment {
            color: #228b22;
            font-size: 11pt;
            font-family: 'Bookman Old Style', serif;
            font-weight: normal;
            font-style: normal;
        }

        .keyword {
            color: #0000ff;
            font-weight: 600;
        }

        .string {
            color: #a31515;
        }

        .number {
            color: #098658;
        }

        .function {
            color: #795e26;
        }

        .operator {
            color: #000000;
        }

        .type {
            color: #267f99;
        }

        .variable {
            color: #001080;
        }

        @media print {
            body {
                padding: 1rem;
            }

            .code-container {
                border: none;
                padding: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="code-container">
            <div class="code-line"><span class="comment">TABLE HELPERS - CSV table manipulation utilities for project map management</span></div>
            <div class="code-line"><span class="keyword">import</span><span class="operator"> </span><span class="variable">path</span><span class="operator"> </span><span class="keyword">from</span><span class="operator"> </span><span class="string">&#039;node:path&#039;</span><span class="operator">;</span></div>
            <div class="code-line"><span class="keyword">import</span><span class="operator"> </span><span class="operator">{</span><span class="operator"> </span><span class="variable">readCsvFile</span><span class="operator">,</span><span class="operator"> </span><span class="variable">writeCsvFile</span><span class="operator"> </span><span class="operator">}</span><span class="operator"> </span><span class="keyword">from</span><span class="operator"> </span><span class="string">&#039;./project-map-sync-core.mjs&#039;</span><span class="operator">;</span></div>
            <div class="code-line"></div>
            <div class="code-line"><span class="comment">Workspace root directory for resolving relative paths</span></div>
            <div class="code-line"><span class="keyword">const</span><span class="operator"> </span><span class="variable">workspaceRoot</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="variable">process</span><span class="operator">.</span><span class="function">cwd</span><span class="operator">(</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"></div>
            <div class="code-line"><span class="comment">==========================================================================================</span></div>
            <div class="code-line"><span class="comment">SECTION 1: PATH RESOLUTION</span></div>
            <div class="code-line"><span class="comment">==========================================================================================</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">Resolves the CSV file path using either an override path or default location.</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">Behavior: - Checks for explicit override path parameter first - Falls back to</span></div>
            <div class="code-line"><span class="comment">CSV_PROJECT_MAP_PATH environment variable - Defaults to &#039;Source/ProjectMap/SourceFolder.</span></div>
            <div class="code-line"><span class="comment">csv&#039; if neither provided - Converts relative paths to absolute using workspace root</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">@param {string} [overridePath=&#039;&#039;] - Optional explicit path to CSV file @returns {string}</span></div>
            <div class="code-line"><span class="comment">Absolute path to the CSV file</span></div>
            <div class="code-line"><span class="keyword">export</span><span class="operator"> </span><span class="keyword">function</span><span class="operator"> </span><span class="function">resolveCsvPath</span><span class="operator">(</span><span class="variable">overridePath</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="variable">process</span><span class="operator">.</span><span class="variable">env</span><span class="operator">.</span><span class="type">CSV_PROJECT_MAP_PATH</span><span class="operator"> </span><span class="operator">?</span><span class="operator">?</span><span class="operator"> </span><span class="string">&#039;&#039;</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">if</span><span class="operator"> </span><span class="operator">(</span><span class="variable">overridePath</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">return</span><span class="operator"> </span><span class="variable">path</span><span class="operator">.</span><span class="function">isAbsolute</span><span class="operator">(</span><span class="variable">overridePath</span><span class="operator">)</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator">?</span><span class="operator"> </span><span class="variable">overridePath</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator">:</span><span class="operator"> </span><span class="variable">path</span><span class="operator">.</span><span class="function">join</span><span class="operator">(</span><span class="variable">workspaceRoot</span><span class="operator">,</span><span class="operator"> </span><span class="variable">overridePath</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">return</span><span class="operator"> </span><span class="variable">path</span><span class="operator">.</span><span class="function">join</span><span class="operator">(</span><span class="variable">workspaceRoot</span><span class="operator">,</span><span class="operator"> </span><span class="string">&#039;Source/ProjectMap/SourceFolder.csv&#039;</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator">}</span></div>
            <div class="code-line"></div>
            <div class="code-line"><span class="comment">==========================================================================================</span></div>
            <div class="code-line"><span class="comment">SECTION 2: CSV TABLE I/O OPERATIONS</span></div>
            <div class="code-line"><span class="comment">==========================================================================================</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">Loads CSV table data and normalizes all rows to consistent width.</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">Delegation: Calls readCsvFile() from project-map-sync-core.mjs for parsing</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">Process: 1. Resolves CSV file path using resolveCsvPath() 2. Reads and parses CSV file</span></div>
            <div class="code-line"><span class="comment">into headers and rows 3. Normalizes all rows to match header count (adds empty strings as</span></div>
            <div class="code-line"><span class="comment">needed)</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">@param {string} [overridePath] - Optional explicit path to CSV file @returns {Promise&lt;{</span></div>
            <div class="code-line"><span class="comment">csvPath: string, headers: string[], rows: string[][]}&gt;} Object containing resolved path,</span></div>
            <div class="code-line"><span class="comment">header array, and normalized row data</span></div>
            <div class="code-line"><span class="keyword">export</span><span class="operator"> </span><span class="keyword">async</span><span class="operator"> </span><span class="keyword">function</span><span class="operator"> </span><span class="function">loadCsvTable</span><span class="operator">(</span><span class="variable">overridePath</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">const</span><span class="operator"> </span><span class="variable">csvPath</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="function">resolveCsvPath</span><span class="operator">(</span><span class="variable">overridePath</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">const</span><span class="operator"> </span><span class="variable">data</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="keyword">await</span><span class="operator"> </span><span class="function">readCsvFile</span><span class="operator">(</span><span class="variable">csvPath</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="function">normalizeRows</span><span class="operator">(</span><span class="variable">data</span><span class="operator">.</span><span class="variable">headers</span><span class="operator">,</span><span class="operator"> </span><span class="variable">data</span><span class="operator">.</span><span class="variable">rows</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">return</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">csvPath</span><span class="operator">,</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">headers</span><span class="operator">:</span><span class="operator"> </span><span class="variable">data</span><span class="operator">.</span><span class="variable">headers</span><span class="operator">,</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">rows</span><span class="operator">:</span><span class="operator"> </span><span class="variable">data</span><span class="operator">.</span><span class="variable">rows</span><span class="operator">,</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator">}</span></div>
            <div class="code-line"></div>
            <div class="code-line"></div>
            <div class="code-line"><span class="comment">Writes normalized CSV table data to disk.</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">Delegation: Calls writeCsvFile() from project-map-sync-core.mjs for serialization</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">Process: 1. Normalizes all rows to consistent width before writing 2. Serializes and</span></div>
            <div class="code-line"><span class="comment">writes data to specified path</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">@param {string} csvPath - Absolute path where CSV should be written @param {string[]}</span></div>
            <div class="code-line"><span class="comment">headers - Array of column header names @param {string[][]} rows - 2D array of row data</span></div>
            <div class="code-line"><span class="comment">@returns {Promise&lt;void&gt;}</span></div>
            <div class="code-line"><span class="keyword">export</span><span class="operator"> </span><span class="keyword">async</span><span class="operator"> </span><span class="keyword">function</span><span class="operator"> </span><span class="function">writeCsvTable</span><span class="operator">(</span><span class="variable">csvPath</span><span class="operator">,</span><span class="operator"> </span><span class="variable">headers</span><span class="operator">,</span><span class="operator"> </span><span class="variable">rows</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="function">normalizeRows</span><span class="operator">(</span><span class="variable">headers</span><span class="operator">,</span><span class="operator"> </span><span class="variable">rows</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">await</span><span class="operator"> </span><span class="function">writeCsvFile</span><span class="operator">(</span><span class="variable">csvPath</span><span class="operator">,</span><span class="operator"> </span><span class="variable">headers</span><span class="operator">,</span><span class="operator"> </span><span class="variable">rows</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator">}</span></div>
            <div class="code-line"></div>
            <div class="code-line"><span class="comment">==========================================================================================</span></div>
            <div class="code-line"><span class="comment">SECTION 3: COLUMN MANAGEMENT</span></div>
            <div class="code-line"><span class="comment">==========================================================================================</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">Ensures a column exists in the table, adding it if missing.</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">Behavior: - Searches for existing column by exact name match (after trimming) - If found,</span></div>
            <div class="code-line"><span class="comment">returns existing column index - If not found, appends new column to end of headers - Adds</span></div>
            <div class="code-line"><span class="comment">empty string cell to all existing rows for new column</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">Side effects: Mutates headers array and all row arrays if column is added</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">@param {string[]} headers - Array of column header names (mutated if column added) @param {</span></div>
            <div class="code-line"><span class="comment">string[][]} rows - 2D array of row data (mutated if column added) @param {string}</span></div>
            <div class="code-line"><span class="comment">headerName - Name of column to ensure exists @returns {number} Index position of the</span></div>
            <div class="code-line"><span class="comment">column (existing or newly added)</span></div>
            <div class="code-line"><span class="keyword">export</span><span class="operator"> </span><span class="keyword">function</span><span class="operator"> </span><span class="function">ensureColumn</span><span class="operator">(</span><span class="variable">headers</span><span class="operator">,</span><span class="operator"> </span><span class="variable">rows</span><span class="operator">,</span><span class="operator"> </span><span class="variable">headerName</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">let</span><span class="operator"> </span><span class="variable">index</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="variable">headers</span><span class="operator">.</span><span class="function">findIndex</span><span class="operator">(</span><span class="operator">(</span><span class="variable">header</span><span class="operator">)</span><span class="operator"> </span><span class="operator">=</span><span class="operator">&gt;</span><span class="operator"> </span><span class="variable">header</span><span class="operator">.</span><span class="function">trim</span><span class="operator">(</span><span class="operator">)</span><span class="operator"> </span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator"> </span><span class="variable">headerName</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">if</span><span class="operator"> </span><span class="operator">(</span><span class="variable">index</span><span class="operator"> </span><span class="operator">!</span><span class="operator">=</span><span class="operator">=</span><span class="operator"> </span><span class="operator">-</span><span class="number">1</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">return</span><span class="operator"> </span><span class="variable">index</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="comment">Column doesn&#039;t exist - add it</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="variable">index</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="variable">headers</span><span class="operator">.</span><span class="variable">length</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="variable">headers</span><span class="operator">.</span><span class="function">push</span><span class="operator">(</span><span class="variable">headerName</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="variable">rows</span><span class="operator">.</span><span class="function">forEach</span><span class="operator">(</span><span class="operator">(</span><span class="variable">row</span><span class="operator">)</span><span class="operator"> </span><span class="operator">=</span><span class="operator">&gt;</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="comment">Pad row to reach new column position if needed</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">while</span><span class="operator"> </span><span class="operator">(</span><span class="variable">row</span><span class="operator">.</span><span class="variable">length</span><span class="operator"> </span><span class="operator">&lt;</span><span class="operator"> </span><span class="variable">index</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">row</span><span class="operator">.</span><span class="function">push</span><span class="operator">(</span><span class="string">&#039;&#039;</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="comment">Add empty cell for new column</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">row</span><span class="operator">.</span><span class="function">push</span><span class="operator">(</span><span class="string">&#039;&#039;</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">return</span><span class="operator"> </span><span class="variable">index</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator">}</span></div>
            <div class="code-line"></div>
            <div class="code-line"></div>
            <div class="code-line"><span class="comment">Ensures multiple columns exist in the table, adding any that are missing.</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">Delegation: Calls ensureColumn() for each header name</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">Behavior: - Processes columns in order provided - Returns mapping of header names to their</span></div>
            <div class="code-line"><span class="comment">column indices - Useful for batch column operations</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">Side effects: Mutates headers and rows arrays via ensureColumn()</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">@param {string[]} headers - Array of column header names (mutated if columns added) @param</span></div>
            <div class="code-line"><span class="comment">{string[][]} rows - 2D array of row data (mutated if columns added) @param {string[]}</span></div>
            <div class="code-line"><span class="comment">headerNames - Array of column names to ensure exist @returns {Object.&lt;string, number&gt;} Map</span></div>
            <div class="code-line"><span class="comment">of header names to their column indices</span></div>
            <div class="code-line"><span class="keyword">export</span><span class="operator"> </span><span class="keyword">function</span><span class="operator"> </span><span class="function">ensureColumns</span><span class="operator">(</span><span class="variable">headers</span><span class="operator">,</span><span class="operator"> </span><span class="variable">rows</span><span class="operator">,</span><span class="operator"> </span><span class="variable">headerNames</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">const</span><span class="operator"> </span><span class="variable">indices</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="operator">{</span><span class="operator">}</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="variable">headerNames</span><span class="operator">.</span><span class="function">forEach</span><span class="operator">(</span><span class="operator">(</span><span class="variable">name</span><span class="operator">)</span><span class="operator"> </span><span class="operator">=</span><span class="operator">&gt;</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">indices</span><span class="operator">[</span><span class="variable">name</span><span class="operator">]</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="function">ensureColumn</span><span class="operator">(</span><span class="variable">headers</span><span class="operator">,</span><span class="operator"> </span><span class="variable">rows</span><span class="operator">,</span><span class="operator"> </span><span class="variable">name</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">return</span><span class="operator"> </span><span class="variable">indices</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator">}</span></div>
            <div class="code-line"></div>
            <div class="code-line"><span class="comment">==========================================================================================</span></div>
            <div class="code-line"><span class="comment">SECTION 4: ROW PATH CONSTRUCTION</span></div>
            <div class="code-line"><span class="comment">==========================================================================================</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">Builds a slash-separated path string from row&#039;s path segment columns.</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">Behavior: - Extracts values from columns before the type column (path segments) - Trims</span></div>
            <div class="code-line"><span class="comment">whitespace from each segment - Skips empty segments - Joins non-empty segments with &#039;/&#039;</span></div>
            <div class="code-line"><span class="comment">separator - Returns &#039;(root)&#039; if no segments found</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">Use case: Creating file system-style paths from hierarchical CSV structure Example: [</span></div>
            <div class="code-line"><span class="comment">&#039;ProjectName&#039;, &#039;src&#039;, &#039;utils&#039;, &#039;&#039;, &#039;&#039;] → &#039;ProjectName/src/utils&#039;</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">@param {string[]} row - Array of cell values for a single row @param {number} typeIndex -</span></div>
            <div class="code-line"><span class="comment">Column index of the Type column (path ends before this) @returns {string} Slash-separated</span></div>
            <div class="code-line"><span class="comment">path or &#039;(root)&#039; if empty</span></div>
            <div class="code-line"><span class="keyword">export</span><span class="operator"> </span><span class="keyword">function</span><span class="operator"> </span><span class="function">buildRowPath</span><span class="operator">(</span><span class="variable">row</span><span class="operator">,</span><span class="operator"> </span><span class="variable">typeIndex</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">const</span><span class="operator"> </span><span class="variable">segments</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="operator">[</span><span class="operator">]</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">for</span><span class="operator"> </span><span class="operator">(</span><span class="keyword">let</span><span class="operator"> </span><span class="variable">i</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="number">0</span><span class="operator">;</span><span class="operator"> </span><span class="variable">i</span><span class="operator"> </span><span class="operator">&lt;</span><span class="operator"> </span><span class="variable">typeIndex</span><span class="operator">;</span><span class="operator"> </span><span class="variable">i</span><span class="operator"> </span><span class="operator">+</span><span class="operator">=</span><span class="operator"> </span><span class="number">1</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">const</span><span class="operator"> </span><span class="variable">value</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="operator">(</span><span class="variable">row</span><span class="operator">[</span><span class="variable">i</span><span class="operator">]</span><span class="operator"> </span><span class="operator">?</span><span class="operator">?</span><span class="operator"> </span><span class="string">&#039;&#039;</span><span class="operator">)</span><span class="operator">.</span><span class="function">trim</span><span class="operator">(</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">if</span><span class="operator"> </span><span class="operator">(</span><span class="variable">value</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">segments</span><span class="operator">.</span><span class="function">push</span><span class="operator">(</span><span class="variable">value</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">return</span><span class="operator"> </span><span class="variable">segments</span><span class="operator">.</span><span class="variable">length</span><span class="operator"> </span><span class="operator">&gt;</span><span class="operator"> </span><span class="number">0</span><span class="operator"> </span><span class="operator">?</span><span class="operator"> </span><span class="variable">segments</span><span class="operator">.</span><span class="function">join</span><span class="operator">(</span><span class="string">&#039;/&#039;</span><span class="operator">)</span><span class="operator"> </span><span class="operator">:</span><span class="operator"> </span><span class="string">&#039;(root)&#039;</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator">}</span></div>
            <div class="code-line"></div>
            <div class="code-line"><span class="comment">==========================================================================================</span></div>
            <div class="code-line"><span class="comment">SECTION 5: VALUE ACCESSOR CREATION</span></div>
            <div class="code-line"><span class="comment">==========================================================================================</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">Creates a closure function for case-insensitive column value access.</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">Factory pattern: Returns a configured accessor function with header mapping</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">Behavior: - Pre-processes headers into uppercase mapping for O(1) lookups - Returns</span></div>
            <div class="code-line"><span class="comment">accessor function that takes (row, headerName, fallback) - Accessor performs</span></div>
            <div class="code-line"><span class="comment">case-insensitive header matching - Returns cell value as string, or fallback if column not</span></div>
            <div class="code-line"><span class="comment">found</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">Performance: Map lookup is cached, making repeated access efficient</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">Usage example: const getValue = createValueAccessor(headers); const type = getValue(row,</span></div>
            <div class="code-line"><span class="comment">&#039;Type&#039;, &#039;unknown&#039;); const features = getValue(row, &#039;FEATURES&#039;, &#039;&#039;);</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">@param {string[]} headers - Array of column header names @returns {function(string[],</span></div>
            <div class="code-line"><span class="comment">string, string=): string} Accessor function that retrieves values by header name (</span></div>
            <div class="code-line"><span class="comment">case-insensitive)</span></div>
            <div class="code-line"><span class="keyword">export</span><span class="operator"> </span><span class="keyword">function</span><span class="operator"> </span><span class="function">createValueAccessor</span><span class="operator">(</span><span class="variable">headers</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="comment">Build case-insensitive header index map</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">const</span><span class="operator"> </span><span class="variable">map</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="keyword">new</span><span class="operator"> </span><span class="function">Map</span><span class="operator">(</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">headers</span><span class="operator">.</span><span class="function">map</span><span class="operator">(</span><span class="operator">(</span><span class="variable">header</span><span class="operator">,</span><span class="operator"> </span><span class="variable">index</span><span class="operator">)</span><span class="operator"> </span><span class="operator">=</span><span class="operator">&gt;</span><span class="operator"> </span><span class="operator">[</span><span class="variable">header</span><span class="operator">.</span><span class="function">trim</span><span class="operator">(</span><span class="operator">)</span><span class="operator">.</span><span class="function">toUpperCase</span><span class="operator">(</span><span class="operator">)</span><span class="operator">,</span><span class="operator"> </span><span class="variable">index</span><span class="operator">]</span><span class="operator">)</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="comment">Return closure that uses the pre-built map</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">return</span><span class="operator"> </span><span class="operator">(</span><span class="variable">row</span><span class="operator">,</span><span class="operator"> </span><span class="variable">headerName</span><span class="operator">,</span><span class="operator"> </span><span class="variable">fallback</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="string">&#039;&#039;</span><span class="operator">)</span><span class="operator"> </span><span class="operator">=</span><span class="operator">&gt;</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">const</span><span class="operator"> </span><span class="variable">normalized</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="variable">headerName</span><span class="operator">.</span><span class="function">trim</span><span class="operator">(</span><span class="operator">)</span><span class="operator">.</span><span class="function">toUpperCase</span><span class="operator">(</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">const</span><span class="operator"> </span><span class="variable">index</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="variable">map</span><span class="operator">.</span><span class="function">get</span><span class="operator">(</span><span class="variable">normalized</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">if</span><span class="operator"> </span><span class="operator">(</span><span class="variable">index</span><span class="operator"> </span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator"> </span><span class="keyword">undefined</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">return</span><span class="operator"> </span><span class="variable">fallback</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">return</span><span class="operator"> </span><span class="operator">(</span><span class="variable">row</span><span class="operator">[</span><span class="variable">index</span><span class="operator">]</span><span class="operator"> </span><span class="operator">?</span><span class="operator">?</span><span class="operator"> </span><span class="string">&#039;&#039;</span><span class="operator">)</span><span class="operator">.</span><span class="function">toString</span><span class="operator">(</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator">}</span></div>
            <div class="code-line"></div>
            <div class="code-line"><span class="comment">==========================================================================================</span></div>
            <div class="code-line"><span class="comment">SECTION 6: ROW NORMALIZATION</span></div>
            <div class="code-line"><span class="comment">==========================================================================================</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">Normalizes all rows to match header count by padding with empty strings.</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">Mutation: Directly modifies row arrays in place</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">Behavior: - Determines target width from headers array length - Iterates through each row</span></div>
            <div class="code-line"><span class="comment">- Skips non-array rows (defensive programming) - Appends empty strings until row length</span></div>
            <div class="code-line"><span class="comment">matches header count - Ensures consistent column count across entire table</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">Use case: Called before CSV write operations to prevent malformed output</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">@param {string[]} headers - Array of column header names (defines target width) @param {</span></div>
            <div class="code-line"><span class="comment">string[][]} rows - 2D array of row data (mutated to match width) @returns {void}</span></div>
            <div class="code-line"><span class="keyword">function</span><span class="operator"> </span><span class="function">normalizeRows</span><span class="operator">(</span><span class="variable">headers</span><span class="operator">,</span><span class="operator"> </span><span class="variable">rows</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">const</span><span class="operator"> </span><span class="variable">width</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="variable">headers</span><span class="operator">.</span><span class="variable">length</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="variable">rows</span><span class="operator">.</span><span class="function">forEach</span><span class="operator">(</span><span class="operator">(</span><span class="variable">row</span><span class="operator">)</span><span class="operator"> </span><span class="operator">=</span><span class="operator">&gt;</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">if</span><span class="operator"> </span><span class="operator">(</span><span class="operator">!</span><span class="type">Array</span><span class="operator">.</span><span class="function">isArray</span><span class="operator">(</span><span class="variable">row</span><span class="operator">)</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">return</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">while</span><span class="operator"> </span><span class="operator">(</span><span class="variable">row</span><span class="operator">.</span><span class="variable">length</span><span class="operator"> </span><span class="operator">&lt;</span><span class="operator"> </span><span class="variable">width</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">row</span><span class="operator">.</span><span class="function">push</span><span class="operator">(</span><span class="string">&#039;&#039;</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator">}</span></div>
            <div class="code-line"></div>
        </div>
    </div>
</body>
</html>