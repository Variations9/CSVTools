<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formatted Code - JavaScript</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', Courier, monospace;
            background: #ffffff;
            padding: 3rem;
            color: #000000;
            line-height: 1.6;
            font-size: 12pt;
            font-weight: bold;
            font-style: normal;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: #ffffff;
        }

        .code-container {
            background: #ffffff;
            padding: 0;
        }

        .code-line {
            white-space: pre-wrap;
            word-wrap: break-word;
            margin-bottom: 0.1rem;
        }

        .comment {
            color: #228b22;
            font-size: 11pt;
            font-family: 'Bookman Old Style', serif;
            font-weight: normal;
            font-style: normal;
        }

        .keyword {
            color: #0000ff;
            font-weight: 600;
        }

        .string {
            color: #a31515;
        }

        .number {
            color: #098658;
        }

        .function {
            color: #795e26;
        }

        .operator {
            color: #000000;
        }

        .type {
            color: #267f99;
        }

        .variable {
            color: #001080;
        }

        @media print {
            body {
                padding: 1rem;
            }

            .code-container {
                border: none;
                padding: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="code-container">
            <div class="code-line"><span class="comment">PROJECT MAP SYNCHRONIZATION CORE Synchronizes CSV project maps with actual file system</span></div>
            <div class="code-line"><span class="comment">structure</span></div>
            <div class="code-line"><span class="keyword">import</span><span class="operator"> </span><span class="variable">fs</span><span class="operator"> </span><span class="keyword">from</span><span class="operator"> </span><span class="string">&#039;node:fs/promises&#039;</span><span class="operator">;</span></div>
            <div class="code-line"><span class="keyword">import</span><span class="operator"> </span><span class="variable">path</span><span class="operator"> </span><span class="keyword">from</span><span class="operator"> </span><span class="string">&#039;node:path&#039;</span><span class="operator">;</span></div>
            <div class="code-line"></div>
            <div class="code-line"><span class="comment">==========================================================================================</span></div>
            <div class="code-line"><span class="comment">SECTION 1: CONFIGURATION AND CONSTANTS</span></div>
            <div class="code-line"><span class="comment">==========================================================================================</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">Default folders to exclude from file system scanning These are commonly ignored</span></div>
            <div class="code-line"><span class="comment">directories in development projects</span></div>
            <div class="code-line"><span class="keyword">const</span><span class="operator"> </span><span class="type">DEFAULT_EXCLUDED_FOLDERS</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="keyword">new</span><span class="operator"> </span><span class="function">Set</span><span class="operator">(</span><span class="operator">[</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="string">&#039;node_modules&#039;</span><span class="operator">,</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="string">&#039;.git&#039;</span><span class="operator">,</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="string">&#039;.vscode&#039;</span><span class="operator">,</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="string">&#039;dist&#039;</span><span class="operator">,</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="string">&#039;build&#039;</span><span class="operator">,</span></div>
            <div class="code-line"><span class="operator">]</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"></div>
            <div class="code-line"><span class="comment">==========================================================================================</span></div>
            <div class="code-line"><span class="comment">SECTION 2: CSV FILE I/O FUNCTIONS</span></div>
            <div class="code-line"><span class="comment">==========================================================================================</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">Load and parse a CSV file that represents the project map.</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">Reads the CSV file from disk and delegates parsing to parseCsv().</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">@param {string} csvPath - Absolute or relative path to the CSV file @returns {Promise&lt;{</span></div>
            <div class="code-line"><span class="comment">headers: string[], rows: string[][] }&gt;} Parsed CSV with headers and data rows</span></div>
            <div class="code-line"><span class="keyword">export</span><span class="operator"> </span><span class="keyword">async</span><span class="operator"> </span><span class="keyword">function</span><span class="operator"> </span><span class="function">readCsvFile</span><span class="operator">(</span><span class="variable">csvPath</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">const</span><span class="operator"> </span><span class="variable">raw</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="keyword">await</span><span class="operator"> </span><span class="variable">fs</span><span class="operator">.</span><span class="function">readFile</span><span class="operator">(</span><span class="variable">csvPath</span><span class="operator">,</span><span class="operator"> </span><span class="string">&#039;utf8&#039;</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">return</span><span class="operator"> </span><span class="function">parseCsv</span><span class="operator">(</span><span class="variable">raw</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator">}</span></div>
            <div class="code-line"></div>
            <div class="code-line"></div>
            <div class="code-line"><span class="comment">Serialize and write the CSV file back to disk.</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">Converts headers and rows to CSV text format and writes to file. Delegates CSV text</span></div>
            <div class="code-line"><span class="comment">generation to buildCsvText().</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">@param {string} csvPath - Path where CSV file will be written @param {string[]} headers -</span></div>
            <div class="code-line"><span class="comment">Column headers @param {string[][]} rows - Data rows to write</span></div>
            <div class="code-line"><span class="keyword">export</span><span class="operator"> </span><span class="keyword">async</span><span class="operator"> </span><span class="keyword">function</span><span class="operator"> </span><span class="function">writeCsvFile</span><span class="operator">(</span><span class="variable">csvPath</span><span class="operator">,</span><span class="operator"> </span><span class="variable">headers</span><span class="operator">,</span><span class="operator"> </span><span class="variable">rows</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">const</span><span class="operator"> </span><span class="variable">csvText</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="function">buildCsvText</span><span class="operator">(</span><span class="variable">headers</span><span class="operator">,</span><span class="operator"> </span><span class="variable">rows</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">await</span><span class="operator"> </span><span class="variable">fs</span><span class="operator">.</span><span class="function">writeFile</span><span class="operator">(</span><span class="variable">csvPath</span><span class="operator">,</span><span class="operator"> </span><span class="variable">csvText</span><span class="operator">,</span><span class="operator"> </span><span class="string">&#039;utf8&#039;</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator">}</span></div>
            <div class="code-line"></div>
            <div class="code-line"><span class="comment">==========================================================================================</span></div>
            <div class="code-line"><span class="comment">SECTION 3: FILE SYSTEM SCANNING FUNCTIONS</span></div>
            <div class="code-line"><span class="comment">==========================================================================================</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">Scan the file system and produce a flat list of entries (folders and files).</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">Recursively walks the directory tree starting from rootPath, building a list of all files</span></div>
            <div class="code-line"><span class="comment">and folders. Each entry includes path segments, full path, and type.</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">Features: - Recursive directory traversal - Configurable folder exclusion (defaults to</span></div>
            <div class="code-line"><span class="comment">node_modules, .git, etc.) - Hidden file filtering (controlled by includeHidden option) -</span></div>
            <div class="code-line"><span class="comment">Sorted output (folders first, then alphabetically) - Error handling for inaccessible</span></div>
            <div class="code-line"><span class="comment">directories - Customizable base path segments - Optional root entry inclusion</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">@param {string} rootPath - Starting directory for the scan @param {object} [options] -</span></div>
            <div class="code-line"><span class="comment">Configuration options @param {string[]} [options.baseSegments] - Custom base path segments</span></div>
            <div class="code-line"><span class="comment">(defaults to root folder name) @param {Iterable&lt;string&gt;} [options.excludeFolders] -</span></div>
            <div class="code-line"><span class="comment">Folders to skip during scan @param {boolean} [options.includeHidden] - Whether to include</span></div>
            <div class="code-line"><span class="comment">hidden files/folders (starting with .) @param {boolean} [options.includeRootEntry] -</span></div>
            <div class="code-line"><span class="comment">Whether to include the root folder itself in results @param {(info: { directory: string,</span></div>
            <div class="code-line"><span class="comment">error: Error }) =&gt; void} [options.onDirectoryError] - Callback for directory read errors</span></div>
            <div class="code-line"><span class="comment">@returns {Promise&lt;Array&lt;{ pathSegments: string[], fullPath: string, type: string }&gt;&gt;} List</span></div>
            <div class="code-line"><span class="comment">of all discovered entries</span></div>
            <div class="code-line"><span class="keyword">export</span><span class="operator"> </span><span class="keyword">async</span><span class="operator"> </span><span class="keyword">function</span><span class="operator"> </span><span class="function">scanProjectTree</span><span class="operator">(</span><span class="variable">rootPath</span><span class="operator">,</span><span class="operator"> </span><span class="variable">options</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="operator">{</span><span class="operator">}</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="comment">Extract and set default options</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">const</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">baseSegments</span><span class="operator">,</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">excludeFolders</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="type">DEFAULT_EXCLUDED_FOLDERS</span><span class="operator">,</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">includeHidden</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="keyword">false</span><span class="operator">,</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">includeRootEntry</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="keyword">true</span><span class="operator">,</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">onDirectoryError</span><span class="operator">,</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="variable">options</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="comment">Determine initial path segments (either custom or root folder name)</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">const</span><span class="operator"> </span><span class="variable">initialSegments</span><span class="operator"> </span><span class="operator">=</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="type">Array</span><span class="operator">.</span><span class="function">isArray</span><span class="operator">(</span><span class="variable">baseSegments</span><span class="operator">)</span><span class="operator"> </span><span class="operator">&amp;</span><span class="operator">&amp;</span><span class="operator"> </span><span class="variable">baseSegments</span><span class="operator">.</span><span class="variable">length</span><span class="operator"> </span><span class="operator">&gt;</span><span class="operator"> </span><span class="number">0</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator">?</span><span class="operator"> </span><span class="variable">baseSegments</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator">:</span><span class="operator"> </span><span class="operator">[</span><span class="variable">path</span><span class="operator">.</span><span class="function">basename</span><span class="operator">(</span><span class="variable">rootPath</span><span class="operator">)</span><span class="operator">]</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">const</span><span class="operator"> </span><span class="variable">excluded</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="keyword">new</span><span class="operator"> </span><span class="function">Set</span><span class="operator">(</span><span class="variable">excludeFolders</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">const</span><span class="operator"> </span><span class="variable">entries</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="operator">[</span><span class="operator">]</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="comment">Add root folder entry if requested</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">if</span><span class="operator"> </span><span class="operator">(</span><span class="variable">includeRootEntry</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">entries</span><span class="operator">.</span><span class="function">push</span><span class="operator">(</span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">pathSegments</span><span class="operator">:</span><span class="operator"> </span><span class="variable">initialSegments</span><span class="operator">,</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">fullPath</span><span class="operator">:</span><span class="operator"> </span><span class="variable">initialSegments</span><span class="operator">.</span><span class="function">join</span><span class="operator">(</span><span class="string">&#039;/&#039;</span><span class="operator">)</span><span class="operator">,</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">type</span><span class="operator">:</span><span class="operator"> </span><span class="string">&#039;folder&#039;</span><span class="operator">,</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="comment">Recursive walker function - processes directories depth-first</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="comment">Maintains path segments array to build full paths</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">async</span><span class="operator"> </span><span class="keyword">function</span><span class="operator"> </span><span class="function">walk</span><span class="operator">(</span><span class="variable">currentPath</span><span class="operator">,</span><span class="operator"> </span><span class="variable">pathSegments</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">let</span><span class="operator"> </span><span class="variable">dirEntries</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">try</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">dirEntries</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="keyword">await</span><span class="operator"> </span><span class="variable">fs</span><span class="operator">.</span><span class="function">readdir</span><span class="operator">(</span><span class="variable">currentPath</span><span class="operator">,</span><span class="operator"> </span><span class="operator">{</span><span class="operator"> </span><span class="variable">withFileTypes</span><span class="operator">:</span><span class="operator"> </span><span class="keyword">true</span><span class="operator"> </span><span class="operator">}</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span><span class="operator"> </span><span class="keyword">catch</span><span class="operator"> </span><span class="operator">(</span><span class="variable">error</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="comment">Allow caller to handle directory read errors</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">if</span><span class="operator"> </span><span class="operator">(</span><span class="keyword">typeof</span><span class="operator"> </span><span class="variable">onDirectoryError</span><span class="operator"> </span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator"> </span><span class="string">&#039;function&#039;</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="function">onDirectoryError</span><span class="operator">(</span><span class="operator">{</span><span class="operator"> </span><span class="variable">directory</span><span class="operator">:</span><span class="operator"> </span><span class="variable">currentPath</span><span class="operator">,</span><span class="operator"> </span><span class="variable">error</span><span class="operator"> </span><span class="operator">}</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">return</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="comment">Sort entries: directories first, then alphabetically within each group</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">dirEntries</span><span class="operator">.</span><span class="function">sort</span><span class="operator">(</span><span class="operator">(</span><span class="variable">a</span><span class="operator">,</span><span class="operator"> </span><span class="variable">b</span><span class="operator">)</span><span class="operator"> </span><span class="operator">=</span><span class="operator">&gt;</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">if</span><span class="operator"> </span><span class="operator">(</span><span class="variable">a</span><span class="operator">.</span><span class="function">isDirectory</span><span class="operator">(</span><span class="operator">)</span><span class="operator"> </span><span class="operator">!</span><span class="operator">=</span><span class="operator">=</span><span class="operator"> </span><span class="variable">b</span><span class="operator">.</span><span class="function">isDirectory</span><span class="operator">(</span><span class="operator">)</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">return</span><span class="operator"> </span><span class="variable">a</span><span class="operator">.</span><span class="function">isDirectory</span><span class="operator">(</span><span class="operator">)</span><span class="operator"> </span><span class="operator">?</span><span class="operator"> </span><span class="operator">-</span><span class="number">1</span><span class="operator"> </span><span class="operator">:</span><span class="operator"> </span><span class="number">1</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">return</span><span class="operator"> </span><span class="variable">a</span><span class="operator">.</span><span class="variable">name</span><span class="operator">.</span><span class="function">localeCompare</span><span class="operator">(</span><span class="variable">b</span><span class="operator">.</span><span class="variable">name</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="comment">Process each directory entry</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">for</span><span class="operator"> </span><span class="operator">(</span><span class="keyword">const</span><span class="operator"> </span><span class="variable">dirent</span><span class="operator"> </span><span class="keyword">of</span><span class="operator"> </span><span class="variable">dirEntries</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="comment">Skip hidden files/folders if not included</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">if</span><span class="operator"> </span><span class="operator">(</span><span class="operator">!</span><span class="variable">includeHidden</span><span class="operator"> </span><span class="operator">&amp;</span><span class="operator">&amp;</span><span class="operator"> </span><span class="variable">dirent</span><span class="operator">.</span><span class="variable">name</span><span class="operator">.</span><span class="function">startsWith</span><span class="operator">(</span><span class="string">&#039;.&#039;</span><span class="operator">)</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">continue</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="comment">Skip excluded folders</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">if</span><span class="operator"> </span><span class="operator">(</span><span class="variable">dirent</span><span class="operator">.</span><span class="function">isDirectory</span><span class="operator">(</span><span class="operator">)</span><span class="operator"> </span><span class="operator">&amp;</span><span class="operator">&amp;</span><span class="operator"> </span><span class="variable">excluded</span><span class="operator">.</span><span class="function">has</span><span class="operator">(</span><span class="variable">dirent</span><span class="operator">.</span><span class="variable">name</span><span class="operator">)</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">continue</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="comment">Build path information for this entry</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">const</span><span class="operator"> </span><span class="variable">nextSegments</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="operator">[</span><span class="operator">.</span><span class="operator">.</span><span class="operator">.</span><span class="variable">pathSegments</span><span class="operator">,</span><span class="operator"> </span><span class="variable">dirent</span><span class="operator">.</span><span class="variable">name</span><span class="operator">]</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">const</span><span class="operator"> </span><span class="variable">fullPath</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="variable">nextSegments</span><span class="operator">.</span><span class="function">join</span><span class="operator">(</span><span class="string">&#039;/&#039;</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">if</span><span class="operator"> </span><span class="operator">(</span><span class="variable">dirent</span><span class="operator">.</span><span class="function">isDirectory</span><span class="operator">(</span><span class="operator">)</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="comment">Add folder entry and recurse into it</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">entries</span><span class="operator">.</span><span class="function">push</span><span class="operator">(</span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">pathSegments</span><span class="operator">:</span><span class="operator"> </span><span class="variable">nextSegments</span><span class="operator">,</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">fullPath</span><span class="operator">,</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">type</span><span class="operator">:</span><span class="operator"> </span><span class="string">&#039;folder&#039;</span><span class="operator">,</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">await</span><span class="operator"> </span><span class="function">walk</span><span class="operator">(</span><span class="variable">path</span><span class="operator">.</span><span class="function">join</span><span class="operator">(</span><span class="variable">currentPath</span><span class="operator">,</span><span class="operator"> </span><span class="variable">dirent</span><span class="operator">.</span><span class="variable">name</span><span class="operator">)</span><span class="operator">,</span><span class="operator"> </span><span class="variable">nextSegments</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span><span class="operator"> </span><span class="keyword">else</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="comment">Add file entry with classified type</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">entries</span><span class="operator">.</span><span class="function">push</span><span class="operator">(</span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">pathSegments</span><span class="operator">:</span><span class="operator"> </span><span class="variable">nextSegments</span><span class="operator">,</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">fullPath</span><span class="operator">,</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">type</span><span class="operator">:</span><span class="operator"> </span><span class="function">classifyFileType</span><span class="operator">(</span><span class="variable">dirent</span><span class="operator">.</span><span class="variable">name</span><span class="operator">)</span><span class="operator">,</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">await</span><span class="operator"> </span><span class="function">walk</span><span class="operator">(</span><span class="variable">rootPath</span><span class="operator">,</span><span class="operator"> </span><span class="variable">initialSegments</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">return</span><span class="operator"> </span><span class="variable">entries</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator">}</span></div>
            <div class="code-line"></div>
            <div class="code-line"><span class="comment">==========================================================================================</span></div>
            <div class="code-line"><span class="comment">SECTION 4: COMPARISON AND SYNCHRONIZATION FUNCTIONS</span></div>
            <div class="code-line"><span class="comment">==========================================================================================</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">Compare the CSV rows with the entries discovered on disk.</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">This is the main synchronization function that reconciles the CSV project map with the</span></div>
            <div class="code-line"><span class="comment">actual file system state. It identifies: - Matched entries (exist in both CSV and file</span></div>
            <div class="code-line"><span class="comment">system) - New entries (on disk but not in CSV) - Deleted entries (in CSV but not on disk)</span></div>
            <div class="code-line"><span class="comment">- Changed entries (type mismatches between CSV and disk) - Duplicate CSV entries (same</span></div>
            <div class="code-line"><span class="comment">path appears multiple times)</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">Features: - Dynamic header expansion to accommodate deeper folder nesting - Automatic</span></div>
            <div class="code-line"><span class="comment">FEATURES column injection if missing - Duplicate path detection in CSV - Type change</span></div>
            <div class="code-line"><span class="comment">detection</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">@param {object} params - Comparison parameters @param {Array&lt;{ pathSegments: string[],</span></div>
            <div class="code-line"><span class="comment">fullPath: string, type: string }&gt;} params.fileSystemEntries - Entries from file system</span></div>
            <div class="code-line"><span class="comment">scan @param {string[][]} params.csvRows - Data rows from CSV file @param {string[]} params.</span></div>
            <div class="code-line"><span class="comment">headers - CSV column headers (will be modified in place if needed) @returns {{</span></div>
            <div class="code-line"><span class="comment">pathColumnCount: number, typeColumnIndex: number, matchedEntries: Array&lt;{ fullPath: string,</span></div>
            <div class="code-line"><span class="comment">pathSegments: string[], csvRow: string[], csvType: string, fsType: string }&gt;, newEntries:</span></div>
            <div class="code-line"><span class="comment">Array&lt;{ pathSegments: string[], fullPath: string, type: string }&gt;, deletedEntries: Array&lt;{</span></div>
            <div class="code-line"><span class="comment">pathSegments: string[], fullPath: string, type: string, row: string[] }&gt;, changedEntries:</span></div>
            <div class="code-line"><span class="comment">Array&lt;{ fullPath: string, pathSegments: string[], csvRow: string[], csvType: string,</span></div>
            <div class="code-line"><span class="comment">fsType: string }&gt;, duplicateCsvEntries: Array&lt;{ fullPath: string, rowIndex: number }&gt; }}</span></div>
            <div class="code-line"><span class="comment">Comprehensive comparison results</span></div>
            <div class="code-line"><span class="keyword">export</span><span class="operator"> </span><span class="keyword">function</span><span class="operator"> </span><span class="function">compareFileSystemToCsv</span><span class="operator">(</span><span class="operator">{</span><span class="operator"> </span><span class="variable">fileSystemEntries</span><span class="operator">,</span><span class="operator"> </span><span class="variable">csvRows</span><span class="operator">,</span><span class="operator"> </span><span class="variable">headers</span><span class="operator"> </span><span class="operator">}</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="comment">Locate the TYPE column and determine initial path column count</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">let</span><span class="operator"> </span><span class="variable">typeColumnIndex</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="function">findTypeColumnIndex</span><span class="operator">(</span><span class="variable">headers</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">let</span><span class="operator"> </span><span class="variable">pathColumnCount</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="variable">typeColumnIndex</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="comment">Calculate maximum depth of file system entries</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">const</span><span class="operator"> </span><span class="variable">maxDepth</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="variable">fileSystemEntries</span><span class="operator">.</span><span class="function">reduce</span><span class="operator">(</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator">(</span><span class="variable">max</span><span class="operator">,</span><span class="operator"> </span><span class="variable">entry</span><span class="operator">)</span><span class="operator"> </span><span class="operator">=</span><span class="operator">&gt;</span><span class="operator"> </span><span class="type">Math</span><span class="operator">.</span><span class="function">max</span><span class="operator">(</span><span class="variable">max</span><span class="operator">,</span><span class="operator"> </span><span class="variable">entry</span><span class="operator">.</span><span class="variable">pathSegments</span><span class="operator">.</span><span class="variable">length</span><span class="operator">)</span><span class="operator">,</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="number">0</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="comment">Expand headers if file system has deeper nesting than CSV columns</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">if</span><span class="operator"> </span><span class="operator">(</span><span class="variable">maxDepth</span><span class="operator"> </span><span class="operator">&gt;</span><span class="operator"> </span><span class="variable">pathColumnCount</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">const</span><span class="operator"> </span><span class="variable">diff</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="variable">maxDepth</span><span class="operator"> </span><span class="operator">-</span><span class="operator"> </span><span class="variable">pathColumnCount</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">const</span><span class="operator"> </span><span class="variable">newPathHeaders</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="operator">[</span><span class="operator">]</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">for</span><span class="operator"> </span><span class="operator">(</span><span class="keyword">let</span><span class="operator"> </span><span class="variable">i</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="number">0</span><span class="operator">;</span><span class="operator"> </span><span class="variable">i</span><span class="operator"> </span><span class="operator">&lt;</span><span class="operator"> </span><span class="variable">diff</span><span class="operator">;</span><span class="operator"> </span><span class="variable">i</span><span class="operator">+</span><span class="operator">+</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">newPathHeaders</span><span class="operator">.</span><span class="function">push</span><span class="operator">(</span><span class="string">`Sub-Folder Level ${pathColumnCount + i + 1}`</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="comment">Insert new path columns before TYPE column</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">headers</span><span class="operator">.</span><span class="function">splice</span><span class="operator">(</span><span class="variable">pathColumnCount</span><span class="operator">,</span><span class="operator"> </span><span class="number">0</span><span class="operator">,</span><span class="operator"> </span><span class="operator">.</span><span class="operator">.</span><span class="operator">.</span><span class="variable">newPathHeaders</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">pathColumnCount</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="variable">maxDepth</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">typeColumnIndex</span><span class="operator"> </span><span class="operator">+</span><span class="operator">=</span><span class="operator"> </span><span class="variable">diff</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="comment">Ensure FEATURES column exists (inserted after TYPE column)</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">if</span><span class="operator"> </span><span class="operator">(</span><span class="operator">!</span><span class="variable">headers</span><span class="operator">.</span><span class="function">includes</span><span class="operator">(</span><span class="string">&#039;FEATURES&#039;</span><span class="operator">)</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">headers</span><span class="operator">.</span><span class="function">splice</span><span class="operator">(</span><span class="variable">typeColumnIndex</span><span class="operator"> </span><span class="operator">+</span><span class="operator"> </span><span class="number">1</span><span class="operator">,</span><span class="operator"> </span><span class="number">0</span><span class="operator">,</span><span class="operator"> </span><span class="string">&#039;FEATURES&#039;</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="comment">Build map of CSV entries by full path</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="comment">Tracks duplicates and stores row information</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">const</span><span class="operator"> </span><span class="variable">csvEntries</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="keyword">new</span><span class="operator"> </span><span class="function">Map</span><span class="operator">(</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">const</span><span class="operator"> </span><span class="variable">duplicateCsvEntries</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="operator">[</span><span class="operator">]</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="variable">csvRows</span><span class="operator">.</span><span class="function">forEach</span><span class="operator">(</span><span class="operator">(</span><span class="variable">row</span><span class="operator">,</span><span class="operator"> </span><span class="variable">rowIndex</span><span class="operator">)</span><span class="operator"> </span><span class="operator">=</span><span class="operator">&gt;</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">const</span><span class="operator"> </span><span class="variable">pathSegments</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="function">extractPathSegmentsFromRow</span><span class="operator">(</span><span class="variable">row</span><span class="operator">,</span><span class="operator"> </span><span class="variable">pathColumnCount</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">if</span><span class="operator"> </span><span class="operator">(</span><span class="variable">pathSegments</span><span class="operator">.</span><span class="variable">length</span><span class="operator"> </span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator"> </span><span class="number">0</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">return</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">const</span><span class="operator"> </span><span class="variable">fullPath</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="variable">pathSegments</span><span class="operator">.</span><span class="function">join</span><span class="operator">(</span><span class="string">&#039;/&#039;</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="comment">Detect and record duplicate paths</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">if</span><span class="operator"> </span><span class="operator">(</span><span class="variable">csvEntries</span><span class="operator">.</span><span class="function">has</span><span class="operator">(</span><span class="variable">fullPath</span><span class="operator">)</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">duplicateCsvEntries</span><span class="operator">.</span><span class="function">push</span><span class="operator">(</span><span class="operator">{</span><span class="operator"> </span><span class="variable">fullPath</span><span class="operator">,</span><span class="operator"> </span><span class="variable">rowIndex</span><span class="operator"> </span><span class="operator">}</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">return</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">csvEntries</span><span class="operator">.</span><span class="function">set</span><span class="operator">(</span><span class="variable">fullPath</span><span class="operator">,</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">pathSegments</span><span class="operator">,</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">type</span><span class="operator">:</span><span class="operator"> </span><span class="operator">(</span><span class="variable">row</span><span class="operator">[</span><span class="variable">typeColumnIndex</span><span class="operator">]</span><span class="operator"> </span><span class="operator">?</span><span class="operator">?</span><span class="operator"> </span><span class="string">&#039;&#039;</span><span class="operator">)</span><span class="operator">.</span><span class="function">trim</span><span class="operator">(</span><span class="operator">)</span><span class="operator">,</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">row</span><span class="operator">,</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">rowIndex</span><span class="operator">,</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="comment">Build map of file system entries by full path</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">const</span><span class="operator"> </span><span class="variable">fsEntries</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="keyword">new</span><span class="operator"> </span><span class="function">Map</span><span class="operator">(</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="variable">fileSystemEntries</span><span class="operator">.</span><span class="function">forEach</span><span class="operator">(</span><span class="operator">(</span><span class="variable">entry</span><span class="operator">)</span><span class="operator"> </span><span class="operator">=</span><span class="operator">&gt;</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">fsEntries</span><span class="operator">.</span><span class="function">set</span><span class="operator">(</span><span class="variable">entry</span><span class="operator">.</span><span class="variable">fullPath</span><span class="operator">,</span><span class="operator"> </span><span class="variable">entry</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="comment">Categorize entries by comparing CSV and file system</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">const</span><span class="operator"> </span><span class="variable">matchedEntries</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="operator">[</span><span class="operator">]</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">const</span><span class="operator"> </span><span class="variable">changedEntries</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="operator">[</span><span class="operator">]</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">const</span><span class="operator"> </span><span class="variable">newEntries</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="operator">[</span><span class="operator">]</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="comment">Process all file system entries</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="variable">fsEntries</span><span class="operator">.</span><span class="function">forEach</span><span class="operator">(</span><span class="operator">(</span><span class="variable">fsEntry</span><span class="operator">,</span><span class="operator"> </span><span class="variable">fullPath</span><span class="operator">)</span><span class="operator"> </span><span class="operator">=</span><span class="operator">&gt;</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">const</span><span class="operator"> </span><span class="variable">csvEntry</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="variable">csvEntries</span><span class="operator">.</span><span class="function">get</span><span class="operator">(</span><span class="variable">fullPath</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">if</span><span class="operator"> </span><span class="operator">(</span><span class="operator">!</span><span class="variable">csvEntry</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="comment">Entry exists on disk but not in CSV - mark as new</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">newEntries</span><span class="operator">.</span><span class="function">push</span><span class="operator">(</span><span class="variable">fsEntry</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">return</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="comment">Entry exists in both - create matched record</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">const</span><span class="operator"> </span><span class="variable">record</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">fullPath</span><span class="operator">,</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">pathSegments</span><span class="operator">:</span><span class="operator"> </span><span class="variable">fsEntry</span><span class="operator">.</span><span class="variable">pathSegments</span><span class="operator">,</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">csvRow</span><span class="operator">:</span><span class="operator"> </span><span class="variable">csvEntry</span><span class="operator">.</span><span class="variable">row</span><span class="operator">,</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">csvType</span><span class="operator">:</span><span class="operator"> </span><span class="variable">csvEntry</span><span class="operator">.</span><span class="variable">type</span><span class="operator">,</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">fsType</span><span class="operator">:</span><span class="operator"> </span><span class="variable">fsEntry</span><span class="operator">.</span><span class="variable">type</span><span class="operator">,</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">matchedEntries</span><span class="operator">.</span><span class="function">push</span><span class="operator">(</span><span class="variable">record</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="comment">Check if type changed between CSV and file system</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">if</span><span class="operator"> </span><span class="operator">(</span><span class="operator">!</span><span class="function">typesEqual</span><span class="operator">(</span><span class="variable">record</span><span class="operator">.</span><span class="variable">csvType</span><span class="operator">,</span><span class="operator"> </span><span class="variable">record</span><span class="operator">.</span><span class="variable">fsType</span><span class="operator">)</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">changedEntries</span><span class="operator">.</span><span class="function">push</span><span class="operator">(</span><span class="variable">record</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="comment">Find entries that exist in CSV but not on disk</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">const</span><span class="operator"> </span><span class="variable">deletedEntries</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="operator">[</span><span class="operator">]</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="variable">csvEntries</span><span class="operator">.</span><span class="function">forEach</span><span class="operator">(</span><span class="operator">(</span><span class="variable">csvEntry</span><span class="operator">,</span><span class="operator"> </span><span class="variable">fullPath</span><span class="operator">)</span><span class="operator"> </span><span class="operator">=</span><span class="operator">&gt;</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">if</span><span class="operator"> </span><span class="operator">(</span><span class="operator">!</span><span class="variable">fsEntries</span><span class="operator">.</span><span class="function">has</span><span class="operator">(</span><span class="variable">fullPath</span><span class="operator">)</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">deletedEntries</span><span class="operator">.</span><span class="function">push</span><span class="operator">(</span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">fullPath</span><span class="operator">,</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">pathSegments</span><span class="operator">:</span><span class="operator"> </span><span class="variable">csvEntry</span><span class="operator">.</span><span class="variable">pathSegments</span><span class="operator">,</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">type</span><span class="operator">:</span><span class="operator"> </span><span class="variable">csvEntry</span><span class="operator">.</span><span class="variable">type</span><span class="operator">,</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">row</span><span class="operator">:</span><span class="operator"> </span><span class="variable">csvEntry</span><span class="operator">.</span><span class="variable">row</span><span class="operator">,</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">return</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">pathColumnCount</span><span class="operator">,</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">typeColumnIndex</span><span class="operator">,</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">matchedEntries</span><span class="operator">,</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">newEntries</span><span class="operator">,</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">deletedEntries</span><span class="operator">,</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">changedEntries</span><span class="operator">,</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">duplicateCsvEntries</span><span class="operator">,</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator">}</span></div>
            <div class="code-line"></div>
            <div class="code-line"><span class="comment">==========================================================================================</span></div>
            <div class="code-line"><span class="comment">SECTION 5: ROW BUILDING AND UPDATE FUNCTIONS</span></div>
            <div class="code-line"><span class="comment">==========================================================================================</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">Produce the updated CSV rows after applying additions and type changes.</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">Rebuilds the entire CSV row set by: 1. Processing matched entries (preserving existing</span></div>
            <div class="code-line"><span class="comment">data, updating types) 2. Adding new entries with empty FEATURES placeholders 3. Sorting</span></div>
            <div class="code-line"><span class="comment">all rows by path for consistent organization</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">Note: This function does NOT include deleted entries - they are filtered out.</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">@param {object} params - Row building parameters @param {string[]} params.headers - CSV</span></div>
            <div class="code-line"><span class="comment">column headers @param {Array&lt;{ pathSegments: string[], csvRow: string[], fsType: string }&gt;}</span></div>
            <div class="code-line"><span class="comment">params.matchedEntries - Entries that exist in both CSV and file system @param {Array&lt;{</span></div>
            <div class="code-line"><span class="comment">pathSegments: string[], fullPath: string, type: string }&gt;} params.newEntries - New entries</span></div>
            <div class="code-line"><span class="comment">to add @param {number} params.pathColumnCount - Number of columns dedicated to path</span></div>
            <div class="code-line"><span class="comment">segments @param {number} params.typeColumnIndex - Index of TYPE column @returns {string[][]</span></div>
            <div class="code-line"><span class="comment">} Complete set of updated rows, sorted by path</span></div>
            <div class="code-line"><span class="keyword">export</span><span class="operator"> </span><span class="keyword">function</span><span class="operator"> </span><span class="function">buildUpdatedRows</span><span class="operator">(</span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="variable">headers</span><span class="operator">,</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="variable">matchedEntries</span><span class="operator">,</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="variable">newEntries</span><span class="operator">,</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="variable">pathColumnCount</span><span class="operator">,</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="variable">typeColumnIndex</span><span class="operator">,</span></div>
            <div class="code-line"><span class="operator">}</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">const</span><span class="operator"> </span><span class="variable">outputRows</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="operator">[</span><span class="operator">]</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">const</span><span class="operator"> </span><span class="variable">headerCount</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="variable">headers</span><span class="operator">.</span><span class="variable">length</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="comment">Process matched entries: preserve existing data, update path and type</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="variable">matchedEntries</span><span class="operator">.</span><span class="function">forEach</span><span class="operator">(</span><span class="operator">(</span><span class="variable">entry</span><span class="operator">)</span><span class="operator"> </span><span class="operator">=</span><span class="operator">&gt;</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">const</span><span class="operator"> </span><span class="variable">nextRow</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="function">copyRow</span><span class="operator">(</span><span class="variable">entry</span><span class="operator">.</span><span class="variable">csvRow</span><span class="operator">,</span><span class="operator"> </span><span class="variable">headerCount</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="comment">Update path columns with current path segments</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">for</span><span class="operator"> </span><span class="operator">(</span><span class="keyword">let</span><span class="operator"> </span><span class="variable">index</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="number">0</span><span class="operator">;</span><span class="operator"> </span><span class="variable">index</span><span class="operator"> </span><span class="operator">&lt;</span><span class="operator"> </span><span class="variable">pathColumnCount</span><span class="operator">;</span><span class="operator"> </span><span class="variable">index</span><span class="operator"> </span><span class="operator">+</span><span class="operator">=</span><span class="operator"> </span><span class="number">1</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">nextRow</span><span class="operator">[</span><span class="variable">index</span><span class="operator">]</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="variable">entry</span><span class="operator">.</span><span class="variable">pathSegments</span><span class="operator">[</span><span class="variable">index</span><span class="operator">]</span><span class="operator"> </span><span class="operator">?</span><span class="operator">?</span><span class="operator"> </span><span class="string">&#039;&#039;</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="comment">Update type to match file system</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">nextRow</span><span class="operator">[</span><span class="variable">typeColumnIndex</span><span class="operator">]</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="variable">entry</span><span class="operator">.</span><span class="variable">fsType</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">outputRows</span><span class="operator">.</span><span class="function">push</span><span class="operator">(</span><span class="variable">nextRow</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="comment">Add new entries with empty cells and placeholder FEATURES</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="variable">newEntries</span><span class="operator">.</span><span class="function">forEach</span><span class="operator">(</span><span class="operator">(</span><span class="variable">entry</span><span class="operator">)</span><span class="operator"> </span><span class="operator">=</span><span class="operator">&gt;</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">const</span><span class="operator"> </span><span class="variable">nextRow</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="keyword">new</span><span class="operator"> </span><span class="function">Array</span><span class="operator">(</span><span class="variable">headerCount</span><span class="operator">)</span><span class="operator">.</span><span class="function">fill</span><span class="operator">(</span><span class="string">&#039;&#039;</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="comment">Populate path columns</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">for</span><span class="operator"> </span><span class="operator">(</span><span class="keyword">let</span><span class="operator"> </span><span class="variable">index</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="number">0</span><span class="operator">;</span><span class="operator"> </span><span class="variable">index</span><span class="operator"> </span><span class="operator">&lt;</span><span class="operator"> </span><span class="variable">entry</span><span class="operator">.</span><span class="variable">pathSegments</span><span class="operator">.</span><span class="variable">length</span><span class="operator">;</span><span class="operator"> </span><span class="variable">index</span><span class="operator"> </span><span class="operator">+</span><span class="operator">=</span><span class="operator"> </span><span class="number">1</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">if</span><span class="operator"> </span><span class="operator">(</span><span class="variable">index</span><span class="operator"> </span><span class="operator">&lt;</span><span class="operator"> </span><span class="variable">pathColumnCount</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">nextRow</span><span class="operator">[</span><span class="variable">index</span><span class="operator">]</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="variable">entry</span><span class="operator">.</span><span class="variable">pathSegments</span><span class="operator">[</span><span class="variable">index</span><span class="operator">]</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="comment">Set type from file system</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">nextRow</span><span class="operator">[</span><span class="variable">typeColumnIndex</span><span class="operator">]</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="variable">entry</span><span class="operator">.</span><span class="variable">type</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="comment">Set empty FEATURES placeholder for new entries</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">const</span><span class="operator"> </span><span class="variable">featuresColumnIndex</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="function">findFeaturesColumnIndex</span><span class="operator">(</span><span class="variable">headers</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">if</span><span class="operator"> </span><span class="operator">(</span><span class="variable">featuresColumnIndex</span><span class="operator"> </span><span class="operator">!</span><span class="operator">=</span><span class="operator">=</span><span class="operator"> </span><span class="operator">-</span><span class="number">1</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">nextRow</span><span class="operator">[</span><span class="variable">featuresColumnIndex</span><span class="operator">]</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="string">&#039;&#039;</span><span class="operator">;</span><span class="operator"> </span><span class="comment">Placeholder for new entries</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">outputRows</span><span class="operator">.</span><span class="function">push</span><span class="operator">(</span><span class="variable">nextRow</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="comment">Sort all rows by path for consistent ordering</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="variable">outputRows</span><span class="operator">.</span><span class="function">sort</span><span class="operator">(</span><span class="operator">(</span><span class="variable">a</span><span class="operator">,</span><span class="operator"> </span><span class="variable">b</span><span class="operator">)</span><span class="operator"> </span><span class="operator">=</span><span class="operator">&gt;</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">const</span><span class="operator"> </span><span class="variable">aKey</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="function">buildPathKey</span><span class="operator">(</span><span class="variable">a</span><span class="operator">,</span><span class="operator"> </span><span class="variable">pathColumnCount</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">const</span><span class="operator"> </span><span class="variable">bKey</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="function">buildPathKey</span><span class="operator">(</span><span class="variable">b</span><span class="operator">,</span><span class="operator"> </span><span class="variable">pathColumnCount</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">return</span><span class="operator"> </span><span class="variable">aKey</span><span class="operator">.</span><span class="function">localeCompare</span><span class="operator">(</span><span class="variable">bKey</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">return</span><span class="operator"> </span><span class="variable">outputRows</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator">}</span></div>
            <div class="code-line"></div>
            <div class="code-line"><span class="comment">==========================================================================================</span></div>
            <div class="code-line"><span class="comment">SECTION 6: TYPE AND CLASSIFICATION HELPERS</span></div>
            <div class="code-line"><span class="comment">==========================================================================================</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">Classify file type based on file extension.</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">Returns a lowercase type string with &quot; file&quot; suffix. Files without extensions are</span></div>
            <div class="code-line"><span class="comment">classified as &quot;file&quot;.</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">@param {string} name - File name to classify @returns {string} Type classification (e.g.,</span></div>
            <div class="code-line"><span class="comment">&quot;.js file&quot;, &quot;.txt file&quot;, &quot;file&quot;)</span></div>
            <div class="code-line"><span class="keyword">function</span><span class="operator"> </span><span class="function">classifyFileType</span><span class="operator">(</span><span class="variable">name</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">const</span><span class="operator"> </span><span class="variable">ext</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="variable">path</span><span class="operator">.</span><span class="function">extname</span><span class="operator">(</span><span class="variable">name</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">if</span><span class="operator"> </span><span class="operator">(</span><span class="operator">!</span><span class="variable">ext</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">return</span><span class="operator"> </span><span class="string">&#039;file&#039;</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">return</span><span class="operator"> </span><span class="string">`${ext.toLowerCase()} file`</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator">}</span></div>
            <div class="code-line"></div>
            <div class="code-line"></div>
            <div class="code-line"><span class="comment">Compare two type strings for equality.</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">Performs case-insensitive comparison after trimming whitespace. Handles null/undefined</span></div>
            <div class="code-line"><span class="comment">values by treating them as empty strings.</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">@param {string} a - First type string @param {string} b - Second type string @returns {</span></div>
            <div class="code-line"><span class="comment">boolean} True if types are equal (case-insensitive)</span></div>
            <div class="code-line"><span class="keyword">function</span><span class="operator"> </span><span class="function">typesEqual</span><span class="operator">(</span><span class="variable">a</span><span class="operator">,</span><span class="operator"> </span><span class="variable">b</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">return</span><span class="operator"> </span><span class="operator">(</span><span class="variable">a</span><span class="operator"> </span><span class="operator">?</span><span class="operator">?</span><span class="operator"> </span><span class="string">&#039;&#039;</span><span class="operator">)</span><span class="operator">.</span><span class="function">trim</span><span class="operator">(</span><span class="operator">)</span><span class="operator">.</span><span class="function">toLowerCase</span><span class="operator">(</span><span class="operator">)</span><span class="operator"> </span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator"> </span><span class="operator">(</span><span class="variable">b</span><span class="operator"> </span><span class="operator">?</span><span class="operator">?</span><span class="operator"> </span><span class="string">&#039;&#039;</span><span class="operator">)</span><span class="operator">.</span><span class="function">trim</span><span class="operator">(</span><span class="operator">)</span><span class="operator">.</span><span class="function">toLowerCase</span><span class="operator">(</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator">}</span></div>
            <div class="code-line"></div>
            <div class="code-line"><span class="comment">==========================================================================================</span></div>
            <div class="code-line"><span class="comment">SECTION 7: PATH AND ROW PROCESSING HELPERS</span></div>
            <div class="code-line"><span class="comment">==========================================================================================</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">Copy a CSV row to a new array of specified width.</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">Creates a new array filled with empty strings, then copies values from the source row.</span></div>
            <div class="code-line"><span class="comment">Handles rows shorter than target width by filling remaining cells with empty strings.</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">@param {string[]} row - Source row to copy @param {number} width - Desired width of output</span></div>
            <div class="code-line"><span class="comment">row @returns {string[]} New row array of specified width</span></div>
            <div class="code-line"><span class="keyword">function</span><span class="operator"> </span><span class="function">copyRow</span><span class="operator">(</span><span class="variable">row</span><span class="operator">,</span><span class="operator"> </span><span class="variable">width</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">const</span><span class="operator"> </span><span class="variable">result</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="keyword">new</span><span class="operator"> </span><span class="function">Array</span><span class="operator">(</span><span class="variable">width</span><span class="operator">)</span><span class="operator">.</span><span class="function">fill</span><span class="operator">(</span><span class="string">&#039;&#039;</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">for</span><span class="operator"> </span><span class="operator">(</span><span class="keyword">let</span><span class="operator"> </span><span class="variable">index</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="number">0</span><span class="operator">;</span><span class="operator"> </span><span class="variable">index</span><span class="operator"> </span><span class="operator">&lt;</span><span class="operator"> </span><span class="variable">width</span><span class="operator">;</span><span class="operator"> </span><span class="variable">index</span><span class="operator"> </span><span class="operator">+</span><span class="operator">=</span><span class="operator"> </span><span class="number">1</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">if</span><span class="operator"> </span><span class="operator">(</span><span class="variable">index</span><span class="operator"> </span><span class="operator">&lt;</span><span class="operator"> </span><span class="variable">row</span><span class="operator">.</span><span class="variable">length</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">result</span><span class="operator">[</span><span class="variable">index</span><span class="operator">]</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="variable">row</span><span class="operator">[</span><span class="variable">index</span><span class="operator">]</span><span class="operator"> </span><span class="operator">?</span><span class="operator">?</span><span class="operator"> </span><span class="string">&#039;&#039;</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">return</span><span class="operator"> </span><span class="variable">result</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator">}</span></div>
            <div class="code-line"></div>
            <div class="code-line"></div>
            <div class="code-line"><span class="comment">Build a normalized path key from a CSV row for sorting.</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">Extracts path segments from the first pathColumnCount columns, joins them with &#039;/&#039;, and</span></div>
            <div class="code-line"><span class="comment">converts to lowercase for case-insensitive sorting.</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">@param {string[]} row - CSV row to process @param {number} pathColumnCount - Number of</span></div>
            <div class="code-line"><span class="comment">columns containing path segments @returns {string} Lowercase path key (e.g.,</span></div>
            <div class="code-line"><span class="comment">&quot;project/src/file.js&quot;)</span></div>
            <div class="code-line"><span class="keyword">function</span><span class="operator"> </span><span class="function">buildPathKey</span><span class="operator">(</span><span class="variable">row</span><span class="operator">,</span><span class="operator"> </span><span class="variable">pathColumnCount</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">const</span><span class="operator"> </span><span class="variable">segments</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="operator">[</span><span class="operator">]</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">for</span><span class="operator"> </span><span class="operator">(</span><span class="keyword">let</span><span class="operator"> </span><span class="variable">index</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="number">0</span><span class="operator">;</span><span class="operator"> </span><span class="variable">index</span><span class="operator"> </span><span class="operator">&lt;</span><span class="operator"> </span><span class="variable">pathColumnCount</span><span class="operator">;</span><span class="operator"> </span><span class="variable">index</span><span class="operator"> </span><span class="operator">+</span><span class="operator">=</span><span class="operator"> </span><span class="number">1</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">const</span><span class="operator"> </span><span class="variable">value</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="operator">(</span><span class="variable">row</span><span class="operator">[</span><span class="variable">index</span><span class="operator">]</span><span class="operator"> </span><span class="operator">?</span><span class="operator">?</span><span class="operator"> </span><span class="string">&#039;&#039;</span><span class="operator">)</span><span class="operator">.</span><span class="function">trim</span><span class="operator">(</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">if</span><span class="operator"> </span><span class="operator">(</span><span class="variable">value</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">segments</span><span class="operator">.</span><span class="function">push</span><span class="operator">(</span><span class="variable">value</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">return</span><span class="operator"> </span><span class="variable">segments</span><span class="operator">.</span><span class="function">join</span><span class="operator">(</span><span class="string">&#039;/&#039;</span><span class="operator">)</span><span class="operator">.</span><span class="function">toLowerCase</span><span class="operator">(</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator">}</span></div>
            <div class="code-line"></div>
            <div class="code-line"></div>
            <div class="code-line"><span class="comment">Extract path segments from a CSV row.</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">Reads the first pathColumnCount columns and collects non-empty values as path segments.</span></div>
            <div class="code-line"><span class="comment">Skips empty cells to handle variable-depth paths.</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">@param {string[]} row - CSV row to process @param {number} pathColumnCount - Number of</span></div>
            <div class="code-line"><span class="comment">columns that may contain path segments @returns {string[]} Array of path segments (empty</span></div>
            <div class="code-line"><span class="comment">array if no segments found)</span></div>
            <div class="code-line"><span class="keyword">function</span><span class="operator"> </span><span class="function">extractPathSegmentsFromRow</span><span class="operator">(</span><span class="variable">row</span><span class="operator">,</span><span class="operator"> </span><span class="variable">pathColumnCount</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">const</span><span class="operator"> </span><span class="variable">segments</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="operator">[</span><span class="operator">]</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">for</span><span class="operator"> </span><span class="operator">(</span><span class="keyword">let</span><span class="operator"> </span><span class="variable">index</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="number">0</span><span class="operator">;</span><span class="operator"> </span><span class="variable">index</span><span class="operator"> </span><span class="operator">&lt;</span><span class="operator"> </span><span class="variable">pathColumnCount</span><span class="operator">;</span><span class="operator"> </span><span class="variable">index</span><span class="operator"> </span><span class="operator">+</span><span class="operator">=</span><span class="operator"> </span><span class="number">1</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">const</span><span class="operator"> </span><span class="variable">value</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="operator">(</span><span class="variable">row</span><span class="operator">[</span><span class="variable">index</span><span class="operator">]</span><span class="operator"> </span><span class="operator">?</span><span class="operator">?</span><span class="operator"> </span><span class="string">&#039;&#039;</span><span class="operator">)</span><span class="operator">.</span><span class="function">trim</span><span class="operator">(</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">if</span><span class="operator"> </span><span class="operator">(</span><span class="variable">value</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">segments</span><span class="operator">.</span><span class="function">push</span><span class="operator">(</span><span class="variable">value</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">return</span><span class="operator"> </span><span class="variable">segments</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator">}</span></div>
            <div class="code-line"></div>
            <div class="code-line"><span class="comment">==========================================================================================</span></div>
            <div class="code-line"><span class="comment">SECTION 8: COLUMN INDEX HELPERS</span></div>
            <div class="code-line"><span class="comment">==========================================================================================</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">Find the index of the TYPE column in headers.</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">Performs case-insensitive search for &quot;type&quot; column. Throws error if TYPE column is not</span></div>
            <div class="code-line"><span class="comment">found, as it is required for operation.</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">@param {string[]} headers - CSV column headers @returns {number} Zero-based index of TYPE</span></div>
            <div class="code-line"><span class="comment">column @throws {Error} If TYPE column is not found</span></div>
            <div class="code-line"><span class="keyword">function</span><span class="operator"> </span><span class="function">findTypeColumnIndex</span><span class="operator">(</span><span class="variable">headers</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">const</span><span class="operator"> </span><span class="variable">index</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="variable">headers</span><span class="operator">.</span><span class="function">findIndex</span><span class="operator">(</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator">(</span><span class="variable">header</span><span class="operator">)</span><span class="operator"> </span><span class="operator">=</span><span class="operator">&gt;</span><span class="operator"> </span><span class="variable">header</span><span class="operator">.</span><span class="function">trim</span><span class="operator">(</span><span class="operator">)</span><span class="operator">.</span><span class="function">toLowerCase</span><span class="operator">(</span><span class="operator">)</span><span class="operator"> </span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator"> </span><span class="string">&#039;type&#039;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">if</span><span class="operator"> </span><span class="operator">(</span><span class="variable">index</span><span class="operator"> </span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator"> </span><span class="operator">-</span><span class="number">1</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">throw</span><span class="operator"> </span><span class="keyword">new</span><span class="operator"> </span><span class="function">Error</span><span class="operator">(</span><span class="string">&#039;The CSV headers do not contain a &quot;Type&quot; column.&#039;</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">return</span><span class="operator"> </span><span class="variable">index</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator">}</span></div>
            <div class="code-line"></div>
            <div class="code-line"></div>
            <div class="code-line"><span class="comment">Find the index of the FEATURES column in headers.</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">Performs case-insensitive search for &quot;features&quot; column. Returns -1 if not found (non-fatal,</span></div>
            <div class="code-line"><span class="comment">as FEATURES column is optional).</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">@param {string[]} headers - CSV column headers @returns {number} Zero-based index of</span></div>
            <div class="code-line"><span class="comment">FEATURES column, or -1 if not found</span></div>
            <div class="code-line"><span class="keyword">function</span><span class="operator"> </span><span class="function">findFeaturesColumnIndex</span><span class="operator">(</span><span class="variable">headers</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">return</span><span class="operator"> </span><span class="variable">headers</span><span class="operator">.</span><span class="function">findIndex</span><span class="operator">(</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator">(</span><span class="variable">header</span><span class="operator">)</span><span class="operator"> </span><span class="operator">=</span><span class="operator">&gt;</span><span class="operator"> </span><span class="variable">header</span><span class="operator">.</span><span class="function">trim</span><span class="operator">(</span><span class="operator">)</span><span class="operator">.</span><span class="function">toLowerCase</span><span class="operator">(</span><span class="operator">)</span><span class="operator"> </span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator"> </span><span class="string">&#039;features&#039;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator">}</span></div>
            <div class="code-line"></div>
            <div class="code-line"><span class="comment">==========================================================================================</span></div>
            <div class="code-line"><span class="comment">SECTION 9: CSV PARSING AND SERIALIZATION FUNCTIONS</span></div>
            <div class="code-line"><span class="comment">==========================================================================================</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">Parse CSV text into headers and data rows.</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">Custom CSV parser that handles: - Quoted fields with embedded commas - Escaped quotes (&quot;&quot;</span></div>
            <div class="code-line"><span class="comment">becomes &quot;) - Both \r\n and \n line endings - Carriage return stripping in headers - Empty</span></div>
            <div class="code-line"><span class="comment">row filtering</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">Features: - State machine approach for quote handling - Preserves internal whitespace in</span></div>
            <div class="code-line"><span class="comment">quoted fields - Trims header values - Filters out completely empty rows</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">@param {string} text - Raw CSV text to parse @returns {{ headers: string[], rows: string[][</span></div>
            <div class="code-line"><span class="comment">] }} Parsed CSV with headers and non-empty data rows @throws {Error} If CSV file is empty</span></div>
            <div class="code-line"><span class="keyword">function</span><span class="operator"> </span><span class="function">parseCsv</span><span class="operator">(</span><span class="variable">text</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">const</span><span class="operator"> </span><span class="variable">rows</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="operator">[</span><span class="operator">]</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">let</span><span class="operator"> </span><span class="variable">currentField</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="string">&#039;&#039;</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">let</span><span class="operator"> </span><span class="variable">currentRow</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="operator">[</span><span class="operator">]</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">let</span><span class="operator"> </span><span class="variable">insideQuotes</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="keyword">false</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="comment">Character-by-character state machine parser</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">for</span><span class="operator"> </span><span class="operator">(</span><span class="keyword">let</span><span class="operator"> </span><span class="variable">index</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="number">0</span><span class="operator">;</span><span class="operator"> </span><span class="variable">index</span><span class="operator"> </span><span class="operator">&lt;</span><span class="operator"> </span><span class="variable">text</span><span class="operator">.</span><span class="variable">length</span><span class="operator">;</span><span class="operator"> </span><span class="variable">index</span><span class="operator"> </span><span class="operator">+</span><span class="operator">=</span><span class="operator"> </span><span class="number">1</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">const</span><span class="operator"> </span><span class="variable">char</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="variable">text</span><span class="operator">[</span><span class="variable">index</span><span class="operator">]</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="comment">Handle quote state transitions</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">if</span><span class="operator"> </span><span class="operator">(</span><span class="variable">insideQuotes</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">if</span><span class="operator"> </span><span class="operator">(</span><span class="variable">char</span><span class="operator"> </span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator"> </span><span class="string">&#039;&quot;&#039;</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">const</span><span class="operator"> </span><span class="variable">nextChar</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="variable">text</span><span class="operator">[</span><span class="variable">index</span><span class="operator"> </span><span class="operator">+</span><span class="operator"> </span><span class="number">1</span><span class="operator">]</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">if</span><span class="operator"> </span><span class="operator">(</span><span class="variable">nextChar</span><span class="operator"> </span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator"> </span><span class="string">&#039;&quot;&#039;</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="comment">Escaped quote: &quot;&quot; becomes &quot;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">currentField</span><span class="operator"> </span><span class="operator">+</span><span class="operator">=</span><span class="operator"> </span><span class="string">&#039;&quot;&#039;</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">index</span><span class="operator"> </span><span class="operator">+</span><span class="operator">=</span><span class="operator"> </span><span class="number">1</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span><span class="operator"> </span><span class="keyword">else</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="comment">End of quoted field</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">insideQuotes</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="keyword">false</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span><span class="operator"> </span><span class="keyword">else</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="comment">Regular character inside quotes</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">currentField</span><span class="operator"> </span><span class="operator">+</span><span class="operator">=</span><span class="operator"> </span><span class="variable">char</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">continue</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="comment">Start of quoted field</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">if</span><span class="operator"> </span><span class="operator">(</span><span class="variable">char</span><span class="operator"> </span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator"> </span><span class="string">&#039;&quot;&#039;</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">insideQuotes</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="keyword">true</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">continue</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="comment">Field delimiter</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">if</span><span class="operator"> </span><span class="operator">(</span><span class="variable">char</span><span class="operator"> </span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator"> </span><span class="string">&#039;,&#039;</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">currentRow</span><span class="operator">.</span><span class="function">push</span><span class="operator">(</span><span class="variable">currentField</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">currentField</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="string">&#039;&#039;</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">continue</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="comment">Row delimiter: handle both \r\n and \n</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">if</span><span class="operator"> </span><span class="operator">(</span><span class="variable">char</span><span class="operator"> </span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator"> </span><span class="string">&#039;\r&#039;</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">const</span><span class="operator"> </span><span class="variable">nextChar</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="variable">text</span><span class="operator">[</span><span class="variable">index</span><span class="operator"> </span><span class="operator">+</span><span class="operator"> </span><span class="number">1</span><span class="operator">]</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">if</span><span class="operator"> </span><span class="operator">(</span><span class="variable">nextChar</span><span class="operator"> </span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator"> </span><span class="string">&#039;\n&#039;</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">index</span><span class="operator"> </span><span class="operator">+</span><span class="operator">=</span><span class="operator"> </span><span class="number">1</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">currentRow</span><span class="operator">.</span><span class="function">push</span><span class="operator">(</span><span class="variable">currentField</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">rows</span><span class="operator">.</span><span class="function">push</span><span class="operator">(</span><span class="variable">currentRow</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">currentRow</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="operator">[</span><span class="operator">]</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">currentField</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="string">&#039;&#039;</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">continue</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">if</span><span class="operator"> </span><span class="operator">(</span><span class="variable">char</span><span class="operator"> </span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator"> </span><span class="string">&#039;\n&#039;</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">currentRow</span><span class="operator">.</span><span class="function">push</span><span class="operator">(</span><span class="variable">currentField</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">rows</span><span class="operator">.</span><span class="function">push</span><span class="operator">(</span><span class="variable">currentRow</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">currentRow</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="operator">[</span><span class="operator">]</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">currentField</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="string">&#039;&#039;</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">continue</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="comment">Regular character</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">currentField</span><span class="operator"> </span><span class="operator">+</span><span class="operator">=</span><span class="operator"> </span><span class="variable">char</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="comment">Handle any remaining field/row at end of file</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">if</span><span class="operator"> </span><span class="operator">(</span><span class="variable">currentRow</span><span class="operator">.</span><span class="variable">length</span><span class="operator"> </span><span class="operator">&gt;</span><span class="operator"> </span><span class="number">0</span><span class="operator"> </span><span class="operator">|</span><span class="operator">|</span><span class="operator"> </span><span class="variable">currentField</span><span class="operator"> </span><span class="operator">!</span><span class="operator">=</span><span class="operator">=</span><span class="operator"> </span><span class="string">&#039;&#039;</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">currentRow</span><span class="operator">.</span><span class="function">push</span><span class="operator">(</span><span class="variable">currentField</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">rows</span><span class="operator">.</span><span class="function">push</span><span class="operator">(</span><span class="variable">currentRow</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">if</span><span class="operator"> </span><span class="operator">(</span><span class="variable">rows</span><span class="operator">.</span><span class="variable">length</span><span class="operator"> </span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator"> </span><span class="number">0</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">throw</span><span class="operator"> </span><span class="keyword">new</span><span class="operator"> </span><span class="function">Error</span><span class="operator">(</span><span class="string">&#039;CSV file is empty.&#039;</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="comment">First row is headers, strip carriage returns and trim</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">const</span><span class="operator"> </span><span class="variable">headers</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="variable">rows</span><span class="operator">[</span><span class="number">0</span><span class="operator">]</span><span class="operator">.</span><span class="function">map</span><span class="operator">(</span><span class="operator">(</span><span class="variable">header</span><span class="operator">)</span><span class="operator"> </span><span class="operator">=</span><span class="operator">&gt;</span><span class="operator"> </span><span class="variable">header</span><span class="operator">.</span><span class="function">replace</span><span class="operator">(</span><span class="operator">/</span><span class="operator">\</span><span class="variable">r</span><span class="operator">/</span><span class="variable">g</span><span class="operator">,</span><span class="operator"> </span><span class="string">&#039;&#039;</span><span class="operator">)</span><span class="operator">.</span><span class="function">trim</span><span class="operator">(</span><span class="operator">)</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="comment">Filter out completely empty data rows</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">const</span><span class="operator"> </span><span class="variable">dataRows</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="variable">rows</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator">.</span><span class="function">slice</span><span class="operator">(</span><span class="number">1</span><span class="operator">)</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator">.</span><span class="function">filter</span><span class="operator">(</span><span class="operator">(</span><span class="variable">row</span><span class="operator">)</span><span class="operator"> </span><span class="operator">=</span><span class="operator">&gt;</span><span class="operator"> </span><span class="variable">row</span><span class="operator">.</span><span class="function">some</span><span class="operator">(</span><span class="operator">(</span><span class="variable">cell</span><span class="operator">)</span><span class="operator"> </span><span class="operator">=</span><span class="operator">&gt;</span><span class="operator"> </span><span class="operator">(</span><span class="variable">cell</span><span class="operator"> </span><span class="operator">?</span><span class="operator">?</span><span class="operator"> </span><span class="string">&#039;&#039;</span><span class="operator">)</span><span class="operator">.</span><span class="function">trim</span><span class="operator">(</span><span class="operator">)</span><span class="operator"> </span><span class="operator">!</span><span class="operator">=</span><span class="operator">=</span><span class="operator"> </span><span class="string">&#039;&#039;</span><span class="operator">)</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">return</span><span class="operator"> </span><span class="operator">{</span><span class="operator"> </span><span class="variable">headers</span><span class="operator">,</span><span class="operator"> </span><span class="variable">rows</span><span class="operator">:</span><span class="operator"> </span><span class="variable">dataRows</span><span class="operator"> </span><span class="operator">}</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator">}</span></div>
            <div class="code-line"></div>
            <div class="code-line"></div>
            <div class="code-line"><span class="comment">Convert headers and rows to CSV text format.</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">Serializes data to RFC 4180-compliant CSV: - All fields are quoted - Quotes within fields</span></div>
            <div class="code-line"><span class="comment">are escaped as &quot;&quot; - Uses \r\n line endings - Includes trailing newline</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">@param {string[]} headers - Column headers @param {string[][]} rows - Data rows @returns {</span></div>
            <div class="code-line"><span class="comment">string} Complete CSV text ready for file writing</span></div>
            <div class="code-line"><span class="keyword">function</span><span class="operator"> </span><span class="function">buildCsvText</span><span class="operator">(</span><span class="variable">headers</span><span class="operator">,</span><span class="operator"> </span><span class="variable">rows</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">const</span><span class="operator"> </span><span class="variable">allRows</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="operator">[</span><span class="variable">headers</span><span class="operator">,</span><span class="operator"> </span><span class="operator">.</span><span class="operator">.</span><span class="operator">.</span><span class="variable">rows</span><span class="operator">]</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">return</span><span class="operator"> </span><span class="variable">allRows</span><span class="operator">.</span><span class="function">map</span><span class="operator">(</span><span class="operator">(</span><span class="variable">row</span><span class="operator">)</span><span class="operator"> </span><span class="operator">=</span><span class="operator">&gt;</span><span class="operator"> </span><span class="variable">row</span><span class="operator">.</span><span class="function">map</span><span class="operator">(</span><span class="variable">escapeForCsv</span><span class="operator">)</span><span class="operator">.</span><span class="function">join</span><span class="operator">(</span><span class="string">&#039;,&#039;</span><span class="operator">)</span><span class="operator">)</span><span class="operator">.</span><span class="function">join</span><span class="operator">(</span><span class="string">&#039;\r\n&#039;</span><span class="operator">)</span><span class="operator"> </span><span class="operator">+</span><span class="operator"> </span><span class="string">&#039;\r\n&#039;</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator">}</span></div>
            <div class="code-line"></div>
            <div class="code-line"></div>
            <div class="code-line"><span class="comment">Escape a single value for CSV format.</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">RFC 4180 compliant escaping: - Converts null/undefined to empty string - Doubles all quote</span></div>
            <div class="code-line"><span class="comment">characters (&quot;&quot; escaping) - Wraps entire value in quotes</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">This aggressive quoting approach ensures all fields are safe, even those containing commas,</span></div>
            <div class="code-line"><span class="comment">newlines, or quotes.</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">@param {*} value - Value to escape (any type, will be converted to string) @returns {</span></div>
            <div class="code-line"><span class="comment">string} Quoted and escaped CSV field</span></div>
            <div class="code-line"><span class="keyword">function</span><span class="operator"> </span><span class="function">escapeForCsv</span><span class="operator">(</span><span class="variable">value</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">const</span><span class="operator"> </span><span class="variable">stringValue</span><span class="operator"> </span><span class="operator">=</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">value</span><span class="operator"> </span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator"> </span><span class="keyword">undefined</span><span class="operator"> </span><span class="operator">|</span><span class="operator">|</span><span class="operator"> </span><span class="variable">value</span><span class="operator"> </span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator"> </span><span class="keyword">null</span><span class="operator"> </span><span class="operator">?</span><span class="operator"> </span><span class="string">&#039;&#039;</span><span class="operator"> </span><span class="operator">:</span><span class="operator"> </span><span class="function">String</span><span class="operator">(</span><span class="variable">value</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">const</span><span class="operator"> </span><span class="variable">escaped</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="variable">stringValue</span><span class="operator">.</span><span class="function">replace</span><span class="operator">(</span><span class="operator">/</span><span class="string">&quot;/g, &#039;&quot;</span><span class="string">&quot;&#039;);</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">return</span><span class="operator"> </span><span class="operator">`</span><span class="operator">&quot;</span><span class="operator">$</span><span class="operator">{</span><span class="variable">escaped</span><span class="operator">}</span><span class="operator">&quot;</span><span class="operator">`</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator">}</span></div>
            <div class="code-line"></div>
        </div>
    </div>
</body>
</html>