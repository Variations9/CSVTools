<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formatted Code - JavaScript</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', Courier, monospace;
            background: #ffffff;
            padding: 3rem;
            color: #000000;
            line-height: 1.6;
            font-size: 12pt;
            font-weight: bold;
            font-style: normal;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: #ffffff;
        }

        .code-container {
            background: #ffffff;
            padding: 0;
        }

        .code-line {
            white-space: pre-wrap;
            word-wrap: break-word;
            margin-bottom: 0.1rem;
        }

        .comment {
            color: #228b22;
            font-size: 11pt;
            font-family: 'Bookman Old Style', serif;
            font-weight: normal;
            font-style: normal;
        }

        .keyword {
            color: #0000ff;
            font-weight: 600;
        }

        .string {
            color: #a31515;
        }

        .number {
            color: #098658;
        }

        .function {
            color: #795e26;
        }

        .operator {
            color: #000000;
        }

        .type {
            color: #267f99;
        }

        .variable {
            color: #001080;
        }

        @media print {
            body {
                padding: 1rem;
            }

            .code-container {
                border: none;
                padding: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="code-container">
            <div class="code-line"><span class="comment">Project Map Preview/Comparison Tool (Dry Run)</span></div>
            <div class="code-line"><span class="keyword">import</span><span class="operator"> </span><span class="variable">path</span><span class="operator"> </span><span class="keyword">from</span><span class="operator"> </span><span class="string">&#039;node:path&#039;</span><span class="operator">;</span></div>
            <div class="code-line"><span class="keyword">import</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="variable">readCsvFile</span><span class="operator">,</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="variable">scanProjectTree</span><span class="operator">,</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="variable">compareFileSystemToCsv</span><span class="operator">,</span></div>
            <div class="code-line"><span class="operator">}</span><span class="operator"> </span><span class="keyword">from</span><span class="operator"> </span><span class="string">&#039;./lib/project-map-sync-core.mjs&#039;</span><span class="operator">;</span></div>
            <div class="code-line"></div>
            <div class="code-line"><span class="comment">CONFIGURATION: Define workspace paths for comparison operations Workspace root is current</span></div>
            <div class="code-line"><span class="comment">working directory where script is executed</span></div>
            <div class="code-line"><span class="keyword">const</span><span class="operator"> </span><span class="variable">workspaceRoot</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="variable">process</span><span class="operator">.</span><span class="function">cwd</span><span class="operator">(</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="comment">Path to the master CSV file containing project structure metadata</span></div>
            <div class="code-line"><span class="keyword">const</span><span class="operator"> </span><span class="variable">csvPath</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="variable">path</span><span class="operator">.</span><span class="function">join</span><span class="operator">(</span><span class="variable">workspaceRoot</span><span class="operator">,</span><span class="operator"> </span><span class="string">&#039;Source/ProjectMap/SourceFolder.csv&#039;</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="comment">Path to the source directory to scan for actual file system structure</span></div>
            <div class="code-line"><span class="keyword">const</span><span class="operator"> </span><span class="variable">sourcePath</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="variable">path</span><span class="operator">.</span><span class="function">join</span><span class="operator">(</span><span class="variable">workspaceRoot</span><span class="operator">,</span><span class="operator"> </span><span class="string">&#039;Source&#039;</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"></div>
            <div class="code-line"><span class="comment">SECTION 1: MAIN COMPARISON ORCHESTRATOR</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">Main orchestration function for dry-run comparison between CSV and file system</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">Purpose: - Compares current file system structure against CSV inventory - Identifies</span></div>
            <div class="code-line"><span class="comment">discrepancies (additions, deletions, type changes, duplicates) - Provides preview of</span></div>
            <div class="code-line"><span class="comment">changes without modifying any files</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">Process Flow: 1. Loads CSV file and filters out snapshot entries 2. Scans actual file</span></div>
            <div class="code-line"><span class="comment">system structure and filters snapshot artifacts 3. Performs comparison to detect</span></div>
            <div class="code-line"><span class="comment">differences 4. Reports detailed summary of findings</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">Output: - Console report showing new entries, deleted entries, type corrections, and</span></div>
            <div class="code-line"><span class="comment">duplicates - Suggests command to apply changes if differences found</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">Error Handling: - Warnings for inaccessible directories during scan - Fatal errors trigger</span></div>
            <div class="code-line"><span class="comment">exit code 1 via catch block</span></div>
            <div class="code-line"><span class="keyword">async</span><span class="operator"> </span><span class="keyword">function</span><span class="operator"> </span><span class="function">main</span><span class="operator">(</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="variable">console</span><span class="operator">.</span><span class="function">log</span><span class="operator">(</span><span class="string">&#039;============================================================&#039;</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="variable">console</span><span class="operator">.</span><span class="function">log</span><span class="operator">(</span><span class="string">&#039;Project Map Comparison (Dry Run)&#039;</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="variable">console</span><span class="operator">.</span><span class="function">log</span><span class="operator">(</span><span class="string">&#039;============================================================\n&#039;</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="comment">STEP 1: Load and parse CSV data</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="variable">console</span><span class="operator">.</span><span class="function">log</span><span class="operator">(</span><span class="string">&#039;[1/3] Loading CSV...&#039;</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">const</span><span class="operator"> </span><span class="variable">csvData</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="keyword">await</span><span class="operator"> </span><span class="function">readCsvFile</span><span class="operator">(</span><span class="variable">csvPath</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="variable">console</span><span class="operator">.</span><span class="function">log</span><span class="operator">(</span><span class="string">`        Rows found: ${csvData.rows.length}`</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="comment">Locate the &quot;Type&quot; column index to determine path column count</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="comment">Path columns precede the Type column (Root Folder through Sub-Folder Level 10)</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">const</span><span class="operator"> </span><span class="variable">typeColumnIndex</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="variable">csvData</span><span class="operator">.</span><span class="variable">headers</span><span class="operator">.</span><span class="function">findIndex</span><span class="operator">(</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator">(</span><span class="variable">header</span><span class="operator">)</span><span class="operator"> </span><span class="operator">=</span><span class="operator">&gt;</span><span class="operator"> </span><span class="variable">header</span><span class="operator">.</span><span class="function">trim</span><span class="operator">(</span><span class="operator">)</span><span class="operator">.</span><span class="function">toLowerCase</span><span class="operator">(</span><span class="operator">)</span><span class="operator"> </span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator"> </span><span class="string">&#039;type&#039;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">if</span><span class="operator"> </span><span class="operator">(</span><span class="variable">typeColumnIndex</span><span class="operator"> </span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator"> </span><span class="operator">-</span><span class="number">1</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">throw</span><span class="operator"> </span><span class="keyword">new</span><span class="operator"> </span><span class="function">Error</span><span class="operator">(</span><span class="string">&#039;Unable to locate &quot;Type&quot; column in CSV header.&#039;</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="comment">Number of path columns = all columns before Type column</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">const</span><span class="operator"> </span><span class="variable">pathColumnCount</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="variable">typeColumnIndex</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="comment">Filter out snapshot CSV files from the comparison dataset</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">const</span><span class="operator"> </span><span class="variable">csvRows</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="variable">csvData</span><span class="operator">.</span><span class="variable">rows</span><span class="operator">.</span><span class="function">filter</span><span class="operator">(</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator">(</span><span class="variable">row</span><span class="operator">)</span><span class="operator"> </span><span class="operator">=</span><span class="operator">&gt;</span><span class="operator"> </span><span class="operator">!</span><span class="function">isSnapshotRow</span><span class="operator">(</span><span class="variable">row</span><span class="operator">,</span><span class="operator"> </span><span class="variable">pathColumnCount</span><span class="operator">)</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="comment">STEP 2: Scan actual file system structure</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="variable">console</span><span class="operator">.</span><span class="function">log</span><span class="operator">(</span><span class="string">&#039;\n[2/3] Scanning workspace...&#039;</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">const</span><span class="operator"> </span><span class="variable">fileSystemEntries</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="keyword">await</span><span class="operator"> </span><span class="function">scanProjectTree</span><span class="operator">(</span><span class="variable">sourcePath</span><span class="operator">,</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">onDirectoryError</span><span class="operator">:</span><span class="operator"> </span><span class="operator">(</span><span class="operator">{</span><span class="operator"> </span><span class="variable">directory</span><span class="operator">,</span><span class="operator"> </span><span class="variable">error</span><span class="operator"> </span><span class="operator">}</span><span class="operator">)</span><span class="operator"> </span><span class="operator">=</span><span class="operator">&gt;</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">console</span><span class="operator">.</span><span class="function">warn</span><span class="operator">(</span><span class="string">`        Warning: skipped ${directory}: ${error.message}`</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span><span class="operator">,</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="comment">Filter out snapshot artifacts from file system results</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">const</span><span class="operator"> </span><span class="variable">filteredEntries</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="variable">fileSystemEntries</span><span class="operator">.</span><span class="function">filter</span><span class="operator">(</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator">(</span><span class="variable">entry</span><span class="operator">)</span><span class="operator"> </span><span class="operator">=</span><span class="operator">&gt;</span><span class="operator"> </span><span class="operator">!</span><span class="function">isSnapshotArtifact</span><span class="operator">(</span><span class="variable">entry</span><span class="operator">.</span><span class="variable">fullPath</span><span class="operator">)</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="variable">console</span><span class="operator">.</span><span class="function">log</span><span class="operator">(</span><span class="string">`        Entries discovered: ${filteredEntries.length}`</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="comment">STEP 3: Compare file system against CSV to identify differences</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="variable">console</span><span class="operator">.</span><span class="function">log</span><span class="operator">(</span><span class="string">&#039;\n[3/3] Comparing results (no changes will be written)...&#039;</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">const</span><span class="operator"> </span><span class="variable">diff</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="function">compareFileSystemToCsv</span><span class="operator">(</span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">fileSystemEntries</span><span class="operator">:</span><span class="operator"> </span><span class="variable">filteredEntries</span><span class="operator">,</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">csvRows</span><span class="operator">,</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">headers</span><span class="operator">:</span><span class="operator"> </span><span class="variable">csvData</span><span class="operator">.</span><span class="variable">headers</span><span class="operator">,</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="comment">Display detailed comparison report</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="function">reportDiff</span><span class="operator">(</span><span class="variable">diff</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator">}</span></div>
            <div class="code-line"></div>
            <div class="code-line"><span class="comment">SECTION 2: REPORTING FUNCTIONS</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">Generates and displays a formatted comparison report</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">Purpose: - Presents comparison results in human-readable format - Categorizes differences</span></div>
            <div class="code-line"><span class="comment">into new entries, deletions, type changes, and duplicates - Provides actionable next steps</span></div>
            <div class="code-line"><span class="comment">for synchronization</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">Parameters: @param {Object} diff - Comparison result object from compareFileSystemToCsv</span></div>
            <div class="code-line"><span class="comment">@param {Array} diff.newEntries - Files/folders present on disk but missing from CSV @param</span></div>
            <div class="code-line"><span class="comment">{Array} diff.deletedEntries - CSV rows for files/folders no longer on disk @param {Array}</span></div>
            <div class="code-line"><span class="comment">diff.changedEntries - Entries with type mismatches between CSV and disk @param {Array}</span></div>
            <div class="code-line"><span class="comment">diff.duplicateCsvEntries - Duplicate paths found in CSV</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">Output Format: - Summary counts for each category - Detailed listings with symbols: + (new)</span></div>
            <div class="code-line"><span class="comment">, - (deleted), ~ (changed), ! (duplicate) - Suggests sync command if changes detected</span></div>
            <div class="code-line"><span class="keyword">function</span><span class="operator"> </span><span class="function">reportDiff</span><span class="operator">(</span><span class="variable">diff</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="variable">console</span><span class="operator">.</span><span class="function">log</span><span class="operator">(</span><span class="string">&#039;\n------------------------------------------------------------&#039;</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="variable">console</span><span class="operator">.</span><span class="function">log</span><span class="operator">(</span><span class="string">&#039;Comparison Summary&#039;</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="variable">console</span><span class="operator">.</span><span class="function">log</span><span class="operator">(</span><span class="string">&#039;------------------------------------------------------------&#039;</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="variable">console</span><span class="operator">.</span><span class="function">log</span><span class="operator">(</span><span class="string">`New entries:      ${diff.newEntries.length}`</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="variable">console</span><span class="operator">.</span><span class="function">log</span><span class="operator">(</span><span class="string">`Deleted entries:  ${diff.deletedEntries.length}`</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="variable">console</span><span class="operator">.</span><span class="function">log</span><span class="operator">(</span><span class="string">`Type corrections: ${diff.changedEntries.length}`</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="variable">console</span><span class="operator">.</span><span class="function">log</span><span class="operator">(</span><span class="string">`Duplicate rows:   ${diff.duplicateCsvEntries.length}`</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="comment">Check if CSV perfectly matches file system (no differences found)</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">if</span><span class="operator"> </span><span class="operator">(</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">diff</span><span class="operator">.</span><span class="variable">newEntries</span><span class="operator">.</span><span class="variable">length</span><span class="operator"> </span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator"> </span><span class="number">0</span><span class="operator"> </span><span class="operator">&amp;</span><span class="operator">&amp;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">diff</span><span class="operator">.</span><span class="variable">deletedEntries</span><span class="operator">.</span><span class="variable">length</span><span class="operator"> </span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator"> </span><span class="number">0</span><span class="operator"> </span><span class="operator">&amp;</span><span class="operator">&amp;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">diff</span><span class="operator">.</span><span class="variable">changedEntries</span><span class="operator">.</span><span class="variable">length</span><span class="operator"> </span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator"> </span><span class="number">0</span><span class="operator"> </span><span class="operator">&amp;</span><span class="operator">&amp;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">diff</span><span class="operator">.</span><span class="variable">duplicateCsvEntries</span><span class="operator">.</span><span class="variable">length</span><span class="operator"> </span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator"> </span><span class="number">0</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">console</span><span class="operator">.</span><span class="function">log</span><span class="operator">(</span><span class="string">&#039;\nThe CSV exactly matches the current file system snapshot.&#039;</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">return</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="comment">Report new entries found on disk but not in CSV</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">if</span><span class="operator"> </span><span class="operator">(</span><span class="variable">diff</span><span class="operator">.</span><span class="variable">newEntries</span><span class="operator">.</span><span class="variable">length</span><span class="operator"> </span><span class="operator">&gt;</span><span class="operator"> </span><span class="number">0</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">console</span><span class="operator">.</span><span class="function">log</span><span class="operator">(</span><span class="string">&#039;\nPending additions:&#039;</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">diff</span><span class="operator">.</span><span class="variable">newEntries</span><span class="operator">.</span><span class="function">forEach</span><span class="operator">(</span><span class="operator">(</span><span class="variable">entry</span><span class="operator">)</span><span class="operator"> </span><span class="operator">=</span><span class="operator">&gt;</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">console</span><span class="operator">.</span><span class="function">log</span><span class="operator">(</span><span class="string">`  + ${entry.fullPath} (${entry.type})`</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="comment">Report CSV entries with no corresponding files/folders on disk</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">if</span><span class="operator"> </span><span class="operator">(</span><span class="variable">diff</span><span class="operator">.</span><span class="variable">deletedEntries</span><span class="operator">.</span><span class="variable">length</span><span class="operator"> </span><span class="operator">&gt;</span><span class="operator"> </span><span class="number">0</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">console</span><span class="operator">.</span><span class="function">log</span><span class="operator">(</span><span class="string">&#039;\nOrphaned CSV rows (missing on disk):&#039;</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">diff</span><span class="operator">.</span><span class="variable">deletedEntries</span><span class="operator">.</span><span class="function">forEach</span><span class="operator">(</span><span class="operator">(</span><span class="variable">entry</span><span class="operator">)</span><span class="operator"> </span><span class="operator">=</span><span class="operator">&gt;</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">console</span><span class="operator">.</span><span class="function">log</span><span class="operator">(</span><span class="string">`  - ${entry.fullPath} (${entry.type})`</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="comment">Report entries where Type field differs between CSV and file system</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">if</span><span class="operator"> </span><span class="operator">(</span><span class="variable">diff</span><span class="operator">.</span><span class="variable">changedEntries</span><span class="operator">.</span><span class="variable">length</span><span class="operator"> </span><span class="operator">&gt;</span><span class="operator"> </span><span class="number">0</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">console</span><span class="operator">.</span><span class="function">log</span><span class="operator">(</span><span class="string">&#039;\nRows requiring type updates:&#039;</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">diff</span><span class="operator">.</span><span class="variable">changedEntries</span><span class="operator">.</span><span class="function">forEach</span><span class="operator">(</span><span class="operator">(</span><span class="variable">entry</span><span class="operator">)</span><span class="operator"> </span><span class="operator">=</span><span class="operator">&gt;</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">console</span><span class="operator">.</span><span class="function">log</span><span class="operator">(</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="string">`  ~ ${entry.fullPath}: ${entry.csvType || &#039;(none)&#039;} -&gt; ${entry.fsType}`</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="comment">Report duplicate paths found in CSV (only first occurrence is kept)</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">if</span><span class="operator"> </span><span class="operator">(</span><span class="variable">diff</span><span class="operator">.</span><span class="variable">duplicateCsvEntries</span><span class="operator">.</span><span class="variable">length</span><span class="operator"> </span><span class="operator">&gt;</span><span class="operator"> </span><span class="number">0</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">console</span><span class="operator">.</span><span class="function">log</span><span class="operator">(</span><span class="string">&#039;\nDuplicated CSV paths (first occurrence kept):&#039;</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">diff</span><span class="operator">.</span><span class="variable">duplicateCsvEntries</span><span class="operator">.</span><span class="function">forEach</span><span class="operator">(</span><span class="operator">(</span><span class="variable">dup</span><span class="operator">)</span><span class="operator"> </span><span class="operator">=</span><span class="operator">&gt;</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">console</span><span class="operator">.</span><span class="function">log</span><span class="operator">(</span><span class="string">`  ! ${dup.fullPath} (row ${dup.rowIndex + 2})`</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="comment">Provide command to apply changes</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="variable">console</span><span class="operator">.</span><span class="function">log</span><span class="operator">(</span><span class="string">&#039;\nTo apply these changes run:&#039;</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="variable">console</span><span class="operator">.</span><span class="function">log</span><span class="operator">(</span><span class="string">&#039;  node Source/Tools/sync-filesystem-to-csv.mjs&#039;</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator">}</span></div>
            <div class="code-line"></div>
            <div class="code-line"><span class="comment">SECTION 3: SNAPSHOT DETECTION UTILITIES Regex pattern for new snapshot file naming</span></div>
            <div class="code-line"><span class="comment">convention Format: SourceFolder-MMM-DD-YYYY-HH-MM-(am|pm)-and-SS-seconds.csv Example:</span></div>
            <div class="code-line"><span class="comment">SourceFolder-Jan-15-2024-03-45-pm-and-30-seconds.csv</span></div>
            <div class="code-line"><span class="keyword">const</span><span class="operator"> </span><span class="type">SNAPSHOT_NAME_REGEX_NEW</span><span class="operator"> </span><span class="operator">=</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator">/</span><span class="operator">^</span><span class="type">Source</span><span class="operator">\</span><span class="operator">/</span><span class="type">ProjectMap</span><span class="operator">\</span><span class="operator">/</span><span class="type">SourceFolder</span><span class="operator">-</span><span class="operator">[</span><span class="type">A</span><span class="operator">-</span><span class="type">Za</span><span class="operator">-</span><span class="variable">z</span><span class="operator">]</span><span class="operator">{</span><span class="number">3</span><span class="operator">}</span><span class="operator">-</span><span class="operator">\</span><span class="variable">d</span><span class="operator">{</span><span class="number">2</span><span class="operator">}</span><span class="operator">-</span><span class="operator">\</span><span class="variable">d</span><span class="operator">{</span><span class="number">4</span><span class="operator">}</span><span class="operator">-</span><span class="operator">\</span><span class="variable">d</span><span class="operator">{</span><span class="number">2</span><span class="operator">}</span><span class="operator">-</span><span class="operator">\</span><span class="variable">d</span><span class="operator">{</span><span class="number">2</span><span class="operator">}</span><span class="operator">-</span><span class="operator">(</span><span class="variable">am</span><span class="operator">|</span><span class="variable">pm</span><span class="operator">)</span><span class="operator">-</span><span class="variable">and</span><span class="operator">-</span><span class="operator">\</span><span class="variable">d</span><span class="operator">{</span><span class="number">2</span><span class="operator">}</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator">-</span><span class="variable">seconds</span><span class="operator">\</span><span class="operator">.</span><span class="variable">csv</span><span class="operator">$</span><span class="operator">/</span><span class="variable">i</span><span class="operator">;</span></div>
            <div class="code-line"><span class="comment">Regex pattern for legacy snapshot file naming convention Format:</span></div>
            <div class="code-line"><span class="comment">FolderStructure_YYYY-MM-DD_HH-MM-SS.csv Example: FolderStructure_2024-01-15_15-45-30.csv</span></div>
            <div class="code-line"><span class="keyword">const</span><span class="operator"> </span><span class="type">SNAPSHOT_NAME_REGEX_OLD</span><span class="operator"> </span><span class="operator">=</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator">/</span><span class="operator">^</span><span class="type">Source</span><span class="operator">\</span><span class="operator">/</span><span class="type">ProjectMap</span><span class="operator">\</span><span class="operator">/</span><span class="type">FolderStructure_</span><span class="operator">\</span><span class="variable">d</span><span class="operator">{</span><span class="number">4</span><span class="operator">}</span><span class="operator">-</span><span class="operator">\</span><span class="variable">d</span><span class="operator">{</span><span class="number">2</span><span class="operator">}</span><span class="operator">-</span><span class="operator">\</span><span class="variable">d</span><span class="operator">{</span><span class="number">2</span><span class="operator">}</span><span class="variable">_</span><span class="operator">\</span><span class="variable">d</span><span class="operator">{</span><span class="number">2</span><span class="operator">}</span><span class="operator">-</span><span class="operator">\</span><span class="variable">d</span><span class="operator">{</span><span class="number">2</span><span class="operator">}</span><span class="operator">-</span><span class="operator">\</span><span class="variable">d</span><span class="operator">{</span><span class="number">2</span><span class="operator">}</span><span class="operator">\</span><span class="operator">.</span><span class="variable">csv</span><span class="operator">$</span><span class="operator">/</span><span class="variable">i</span><span class="operator">;</span></div>
            <div class="code-line"></div>
            <div class="code-line"></div>
            <div class="code-line"><span class="comment">Determines if a file path represents a snapshot CSV artifact</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">Purpose: - Identifies historical snapshot files that should be excluded from comparisons -</span></div>
            <div class="code-line"><span class="comment">Supports both current and legacy snapshot naming conventions</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">Parameters: @param {string} fullPath - Complete file path to evaluate</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">Returns: @returns {boolean} - True if path matches any snapshot pattern, false otherwise</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">Implementation: - Tests path against both new and old snapshot naming patterns -</span></div>
            <div class="code-line"><span class="comment">Case-insensitive matching for robustness</span></div>
            <div class="code-line"><span class="keyword">function</span><span class="operator"> </span><span class="function">isSnapshotArtifact</span><span class="operator">(</span><span class="variable">fullPath</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">return</span><span class="operator"> </span><span class="type">SNAPSHOT_NAME_REGEX_NEW</span><span class="operator">.</span><span class="function">test</span><span class="operator">(</span><span class="variable">fullPath</span><span class="operator">)</span><span class="operator"> </span><span class="operator">|</span><span class="operator">|</span><span class="operator"> </span><span class="type">SNAPSHOT_NAME_REGEX_OLD</span><span class="operator">.</span><span class="function">test</span><span class="operator">(</span><span class="variable">fullPath</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator">}</span></div>
            <div class="code-line"></div>
            <div class="code-line"></div>
            <div class="code-line"><span class="comment">Determines if a CSV row represents a snapshot file entry</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">Purpose: - Filters snapshot CSV entries from comparison dataset - Reconstructs full path</span></div>
            <div class="code-line"><span class="comment">from CSV row&#039;s hierarchical folder structure</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">Parameters: @param {Array} row - CSV row as array of column values @param {number}</span></div>
            <div class="code-line"><span class="comment">pathColumnCount - Number of columns representing path segments</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">Returns: @returns {boolean} - True if row represents a snapshot artifact, false otherwise</span></div>
            <div class="code-line">&nbsp;</div>
            <div class="code-line"><span class="comment">Implementation: - Extracts path segments from first N columns (before Type column) - Joins</span></div>
            <div class="code-line"><span class="comment">non-empty segments with &#039;/&#039; to form complete path - Delegates to isSnapshotArtifact for</span></div>
            <div class="code-line"><span class="comment">pattern matching</span></div>
            <div class="code-line"><span class="keyword">function</span><span class="operator"> </span><span class="function">isSnapshotRow</span><span class="operator">(</span><span class="variable">row</span><span class="operator">,</span><span class="operator"> </span><span class="variable">pathColumnCount</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">const</span><span class="operator"> </span><span class="variable">segments</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="operator">[</span><span class="operator">]</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">for</span><span class="operator"> </span><span class="operator">(</span><span class="keyword">let</span><span class="operator"> </span><span class="variable">index</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="number">0</span><span class="operator">;</span><span class="operator"> </span><span class="variable">index</span><span class="operator"> </span><span class="operator">&lt;</span><span class="operator"> </span><span class="variable">pathColumnCount</span><span class="operator">;</span><span class="operator"> </span><span class="variable">index</span><span class="operator"> </span><span class="operator">+</span><span class="operator">=</span><span class="operator"> </span><span class="number">1</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">const</span><span class="operator"> </span><span class="variable">value</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="operator">(</span><span class="variable">row</span><span class="operator">[</span><span class="variable">index</span><span class="operator">]</span><span class="operator"> </span><span class="operator">?</span><span class="operator">?</span><span class="operator"> </span><span class="string">&#039;&#039;</span><span class="operator">)</span><span class="operator">.</span><span class="function">trim</span><span class="operator">(</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="keyword">if</span><span class="operator"> </span><span class="operator">(</span><span class="variable">value</span><span class="operator">)</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="variable">segments</span><span class="operator">.</span><span class="function">push</span><span class="operator">(</span><span class="variable">value</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="operator">}</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">const</span><span class="operator"> </span><span class="variable">key</span><span class="operator"> </span><span class="operator">=</span><span class="operator"> </span><span class="variable">segments</span><span class="operator">.</span><span class="function">join</span><span class="operator">(</span><span class="string">&#039;/&#039;</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="keyword">return</span><span class="operator"> </span><span class="function">isSnapshotArtifact</span><span class="operator">(</span><span class="variable">key</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator">}</span></div>
            <div class="code-line"></div>
            <div class="code-line"><span class="comment">Execute main comparison function with global error handling</span></div>
            <div class="code-line"><span class="function">main</span><span class="operator">(</span><span class="operator">)</span><span class="operator">.</span><span class="keyword">catch</span><span class="operator">(</span><span class="operator">(</span><span class="variable">error</span><span class="operator">)</span><span class="operator"> </span><span class="operator">=</span><span class="operator">&gt;</span><span class="operator"> </span><span class="operator">{</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="variable">console</span><span class="operator">.</span><span class="function">error</span><span class="operator">(</span><span class="string">&#039;\nComparison failed.&#039;</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="variable">console</span><span class="operator">.</span><span class="function">error</span><span class="operator">(</span><span class="variable">error</span><span class="operator">.</span><span class="variable">stack</span><span class="operator"> </span><span class="operator">|</span><span class="operator">|</span><span class="operator"> </span><span class="variable">error</span><span class="operator">.</span><span class="variable">message</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator"> </span><span class="operator"> </span><span class="variable">process</span><span class="operator">.</span><span class="function">exit</span><span class="operator">(</span><span class="number">1</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"><span class="operator">}</span><span class="operator">)</span><span class="operator">;</span></div>
            <div class="code-line"></div>
        </div>
    </div>
</body>
</html>